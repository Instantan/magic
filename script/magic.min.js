(()=>{var F=Object.create;var A=Object.defineProperty;var W=Object.getOwnPropertyDescriptor;var K=Object.getOwnPropertyNames;var X=Object.getPrototypeOf,j=Object.prototype.hasOwnProperty;var m=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var J=(t,e,n,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of K(e))!j.call(t,o)&&o!==n&&A(t,o,{get:()=>e[o],enumerable:!(r=W(e,o))||r.enumerable});return t};var z=(t,e,n)=>(n=t!=null?F(X(t)):{},J(e||!t||!t.__esModule?A(n,"default",{value:t,enumerable:!0}):n,t));var S=m((Re,R)=>{f.notEqual=Q;f.notOk=Y;f.equal=G;f.ok=f;R.exports=f;function G(t,e,n){f(t==e,n)}function Q(t,e,n){f(t!=e,n)}function Y(t,e){f(!t,e)}function f(t,e){if(!t)throw new Error(e||"AssertionError")}});var C=m((Se,T)=>{T.exports=["onclick","ondblclick","onmousedown","onmouseup","onmouseover","onmousemove","onmouseout","onmouseenter","onmouseleave","ontouchcancel","ontouchend","ontouchmove","ontouchstart","ondragstart","ondrag","ondragenter","ondragleave","ondragover","ondrop","ondragend","onkeydown","onkeypress","onkeyup","onunload","onabort","onerror","onresize","onscroll","onselect","onchange","onsubmit","onreset","onfocus","onblur","oninput","onanimationend","onanimationiteration","onanimationstart","oncontextmenu","onfocusin","onfocusout"]});var M=m((Te,I)=>{var O=C(),Z=O.length,N=1,ee=3,te=8;I.exports=ne;function ne(t,e){var n=t.nodeType,r=t.nodeName;n===N&&ie(t,e),(n===ee||n===te)&&e.nodeValue!==t.nodeValue&&(e.nodeValue=t.nodeValue),r==="INPUT"?ce(t,e):r==="OPTION"?oe(t,e):r==="TEXTAREA"&&ae(t,e),re(t,e)}function ie(t,e){for(var n=e.attributes,r=t.attributes,o=null,c=null,u=null,a=null,s=null,p=r.length-1;p>=0;--p)s=r[p],a=s.name,o=s.namespaceURI,c=s.value,o?(a=s.localName||a,u=e.getAttributeNS(o,a),u!==c&&e.setAttributeNS(o,a,c)):e.hasAttribute(a)?(u=e.getAttribute(a),u!==c&&(c==="null"||c==="undefined"?e.removeAttribute(a):e.setAttribute(a,c))):e.setAttribute(a,c);for(var h=n.length-1;h>=0;--h)s=n[h],s.specified!==!1&&(a=s.name,o=s.namespaceURI,o?(a=s.localName||a,t.hasAttributeNS(o,a)||e.removeAttributeNS(o,a)):t.hasAttributeNS(null,a)||e.removeAttribute(a))}function re(t,e){for(var n=0;n<Z;n++){var r=O[n];t[r]?e[r]=t[r]:e[r]&&(e[r]=void 0)}}function oe(t,e){w(t,e,"selected")}function ce(t,e){var n=t.value,r=e.value;w(t,e,"checked"),w(t,e,"disabled"),t.indeterminate!==e.indeterminate&&(e.indeterminate=t.indeterminate),e.type!=="file"&&(n!==r&&(e.setAttribute("value",n),e.value=n),n==="null"&&(e.value="",e.removeAttribute("value")),t.hasAttributeNS(null,"value")?e.type==="range"&&(e.value=n):e.removeAttribute("value"))}function ae(t,e){var n=t.value;if(n!==e.value&&(e.value=n),e.firstChild&&e.firstChild.nodeValue!==n){if(n===""&&e.firstChild.nodeValue===e.placeholder)return;e.firstChild.nodeValue=n}}function w(t,e,n){t[n]!==e[n]&&(e[n]=t[n],t[n]?e.setAttribute(n,""):e.removeAttribute(n))}});var D=m((Ce,q)=>{var v=S(),se=M(),ue=3;q.exports=fe;function fe(t,e,n){return v.equal(typeof t,"object","nanomorph: oldTree should be an object"),v.equal(typeof e,"object","nanomorph: newTree should be an object"),n&&n.childrenOnly?(L(e,t),t):(v.notEqual(e.nodeType,11,"nanomorph: newTree should have one root node (which is not a DocumentFragment)"),d(e,t))}function d(t,e){return e?t?t.isSameNode&&t.isSameNode(e)?e:t.tagName!==e.tagName||V(t)!==V(e)?t:(se(t,e),L(t,e),e):null:t}function V(t){return t.dataset?t.dataset.nanomorphComponentId:void 0}function L(t,e){for(var n,r,o,c,u=0,a=0;n=e.childNodes[a],r=t.childNodes[a-u],!(!n&&!r);a++)if(!r)e.removeChild(n),a--;else if(!n)e.appendChild(r),u++;else if(_(r,n))o=d(r,n),o!==n&&(e.replaceChild(o,n),u++);else{c=null;for(var s=a;s<e.childNodes.length;s++)if(_(e.childNodes[s],r)){c=e.childNodes[s];break}c?(o=d(r,c),o!==c&&u++,e.insertBefore(o,n)):!r.id&&!n.id?(o=d(r,n),o!==n&&(e.replaceChild(o,n),u++)):(e.insertBefore(r,n),u++)}}function _(t,e){return t.id?t.id===e.id:t.isSameNode?t.isSameNode(e):t.tagName!==e.tagName?!1:t.type===ue?t.nodeValue===e.nodeValue:!1}});var H=z(D());window.magic={templates:new Map,socketrefs:new Map,socketrefs_refs:new Map,didRenderRoot:!1,socket:null,baseProps:["metaKey","ctrlKey","shiftKey"],themeColor:()=>{let t=document.querySelector('meta[name="theme-color"]');return t?t.attributes.getNamedItem("content").value:"rgb(59,130,246)"}};function $(){x();let t=new URLSearchParams(location.search);t.append("ws","0"),window.magic.socket=new WebSocket("ws://"+location.host+location.pathname+"?"+t),window.magic.socket.onopen=function(){window.magic.templates={},window.magic.socketrefs={},window.magic.socketrefs_refs={},window.magic.didRenderRoot=!1},window.magic.socket.onmessage=function(e){ye(),le(JSON.parse(e.data))},window.magic.socket.onclose=function(e){x(),setTimeout($,1e3)},window.magic.socket.onerror=function(e){console.error("Socket encountered error: ",e,"Closing socket"),magic.socket.close()}}function le(t){let e=new Set;t.forEach(n=>{if(n.length===2&&typeof n[0]=="number")window.magic.templates[n[0]]=n[1],he(n[0]);else if(n.length===2&&me(n[0])){let r=n[0];if(Ee(r,n[1]),!window.magic.didRenderRoot)return;e.add(r)}}),e.forEach(n=>{we(n)}),window.magic.didRenderRoot||(y(document,b(U())),g(document),window.magic.didRenderRoot=!0)}function me(t){return typeof t=="string"}function k(t){return t&&t.length===2&&typeof t[0]=="string"}function U(){let t=window.magic.socketrefs[0]["#"];return E(t)}function E(t){return de(`${t[0]}:${t[1]}`,window.magic.templates[t[1]],window.magic.socketrefs[t[0]])}function de(t,e,n){return pe(e,o=>{if(o==="magic:live")return ge();if(o==="magic:id")return`magic-id="${t}"`;if(n===void 0)return"";let c=n[o];return c==null?"":k(c)?E(c):c})}function ge(){return"<script>"+document.head.children[0].innerHTML+"<\/script>"}function pe(t,e){return t.replace(/~.+?~/g,(n,r,o,c)=>e(n.slice(1,-1)))}function b(t){if(t.toLowerCase().trim().indexOf("<!doctype")===0){let e=document.implementation.createHTMLDocument("");return e.documentElement.innerHTML=t,e}else if("content"in document.createElement("template")){let e=document.createElement("template");return e.innerHTML=t,e.content}else{let e=document.createDocumentFragment(),n=document.createElement("body");for(n.innerHTML=t,i=0;0<n.childNodes.length;)e.appendChild(n.childNodes[i]);return e}}function y(t,e){(0,H.default)(t,e)}function he(t){window.magic.templates[t]=window.magic.templates[t].replace(/<\w*(\s|>|\/>)/m,(e,n,r,o)=>e.endsWith("/>")?e.slice(0,-1)+" ~magic:id~/>":e.endsWith(">")?e.slice(0,-1)+" ~magic:id~>":e+"~magic:id~ ")}function we(t){if(t===magic.socketrefs[0]["#"][0]){y(document,b(U())),g(document),console.debug("[RENDERED]",document);return}document.querySelectorAll(`[magic-id^="${t}"]`).forEach(e=>{let n=b(E(e.attributes.getNamedItem("magic-id").value.split(":")));y(e,n.children[0]),g(e),console.debug("[RENDERED]",e)})}function g(t){ke(t);let e=t.attributes;if(e)for(let n=0;n<e.length;n++)e[n].name.startsWith("magic")&&ve(t,e[n]);if(t.children)for(let n=0;n<t.children.length;n++)g(t.children[n])}function ve(t,e){let n=e.name.slice(6),r=e.value,o=window.magic.baseProps;switch(n){case"click":t.onclick=l(n,[...o],r);return;case"focus":t.onfocus=l(n,[...o],r);return;case"change":t.onchange=l(n,[...o],r);return;case"keydown":t.onkeydown=l(n,[...o],r);return;case"keypress":t.onkeypress=l(n,[...o],r);return;case"keyup":t.onkeyup=l(n,[...o],r);return;case"submit":t.onsubmit=l(n,[...o],r);return;case"dblclick":t.ondblclick=l(n,[...o],r);return}}function ke(t){t.onclick=null,t.onfocus=null,t.onchange=null,t.onkeydown=null,t.onkeypress=null,t.onkeyup=null,t.onsubmit=null,t.ondblclick=null}function l(t,e,n){return r=>{let o=Object.assign(be(r,e),{value:n});if(window.magic.socket){let c=Number(B(r.target));window.magic.socket.send(JSON.stringify({kind:t,target:c,payload:o}))}}}function be(t,e,n){let r={};for(let o=0;o<e.length;o++){let c=t[e[o]];c!==void 0&&(r[e[o]]=c)}return r}function x(){if(window.magic.topbar)return;let t=window.magic.themeColor(),e=document.createElement("div");e.style="position:fixed;overflow:hidden;top:0;left:0;width:100%";let n=document.createElement("div");n.style=`background-color:${t};height:.2rem;width:100%;opacity:0.4`;let r=document.createElement("div");r.style=`background-color:${t};position:absolute;bottom:0;top:0;width:50%`,e.appendChild(n),e.appendChild(r);let o=setTimeout(()=>{document.body.appendChild(e),r.animate([{left:"-50%"},{left:"100%"}],{duration:800,iterations:1/0})},120);e.destroy=()=>{clearInterval(o),e.remove()},window.magic.topbar=e}function ye(){window.magic.topbar&&(window.magic.topbar.destroy(),window.magic.topbar=null)}function Ee(t,e){let n=Object.keys(e),r=n.length;for(;r--;){let o=e[n[r]];k(o)&&P(o[0],1)}if(window.magic.socketrefs[t]===void 0)window.magic.socketrefs[t]=e;else{for(r=n.length;r--;){let o=window.magic.socketrefs[t][n[r]];k(o)&&P(o[0],-1)}Object.assign(window.magic.socketrefs[t],e)}}function P(t,e){window.magic.socketrefs_refs[t]!==void 0?window.magic.socketrefs_refs[t]+=e:window.magic.socketrefs_refs[t]=e,e<0&&window.magic.socketrefs_refs[t]<1&&(delete window.magic.socketrefs[t],delete window.magic.socketrefs_refs[t])}function B(t){let e=t.attributes.getNamedItem("magic-id");return e!==null?e.value.split(":",1)[0]:t.parentNode?B(t):window.magic.socketrefs[0]["#"][0]}document.addEventListener("DOMContentLoaded",$);})();
