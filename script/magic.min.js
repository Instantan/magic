(()=>{var B=Object.create;var A=Object.defineProperty;var F=Object.getOwnPropertyDescriptor;var W=Object.getOwnPropertyNames;var K=Object.getPrototypeOf,X=Object.prototype.hasOwnProperty;var m=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var j=(t,e,n,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of W(e))!X.call(t,o)&&o!==n&&A(t,o,{get:()=>e[o],enumerable:!(r=F(e,o))||r.enumerable});return t};var J=(t,e,n)=>(n=t!=null?B(K(t)):{},j(e||!t||!t.__esModule?A(n,"default",{value:t,enumerable:!0}):n,t));var S=m((Ae,R)=>{l.notEqual=G;l.notOk=Q;l.equal=z;l.ok=l;R.exports=l;function z(t,e,n){l(t==e,n)}function G(t,e,n){l(t!=e,n)}function Q(t,e){l(!t,e)}function l(t,e){if(!t)throw new Error(e||"AssertionError")}});var C=m((Re,T)=>{T.exports=["onclick","ondblclick","onmousedown","onmouseup","onmouseover","onmousemove","onmouseout","onmouseenter","onmouseleave","ontouchcancel","ontouchend","ontouchmove","ontouchstart","ondragstart","ondrag","ondragenter","ondragleave","ondragover","ondrop","ondragend","onkeydown","onkeypress","onkeyup","onunload","onabort","onerror","onresize","onscroll","onselect","onchange","onsubmit","onreset","onfocus","onblur","oninput","onanimationend","onanimationiteration","onanimationstart","oncontextmenu","onfocusin","onfocusout"]});var M=m((Se,I)=>{var O=C(),Y=O.length,Z=1,N=3,ee=8;I.exports=te;function te(t,e){var n=t.nodeType,r=t.nodeName;n===Z&&ne(t,e),(n===N||n===ee)&&e.nodeValue!==t.nodeValue&&(e.nodeValue=t.nodeValue),r==="INPUT"?oe(t,e):r==="OPTION"?re(t,e):r==="TEXTAREA"&&ae(t,e),ie(t,e)}function ne(t,e){for(var n=e.attributes,r=t.attributes,o=null,c=null,u=null,a=null,s=null,p=r.length-1;p>=0;--p)s=r[p],a=s.name,o=s.namespaceURI,c=s.value,o?(a=s.localName||a,u=e.getAttributeNS(o,a),u!==c&&e.setAttributeNS(o,a,c)):e.hasAttribute(a)?(u=e.getAttribute(a),u!==c&&(c==="null"||c==="undefined"?e.removeAttribute(a):e.setAttribute(a,c))):e.setAttribute(a,c);for(var w=n.length-1;w>=0;--w)s=n[w],s.specified!==!1&&(a=s.name,o=s.namespaceURI,o?(a=s.localName||a,t.hasAttributeNS(o,a)||e.removeAttributeNS(o,a)):t.hasAttributeNS(null,a)||e.removeAttribute(a))}function ie(t,e){for(var n=0;n<Y;n++){var r=O[n];t[r]?e[r]=t[r]:e[r]&&(e[r]=void 0)}}function re(t,e){v(t,e,"selected")}function oe(t,e){var n=t.value,r=e.value;v(t,e,"checked"),v(t,e,"disabled"),t.indeterminate!==e.indeterminate&&(e.indeterminate=t.indeterminate),e.type!=="file"&&(n!==r&&(e.setAttribute("value",n),e.value=n),n==="null"&&(e.value="",e.removeAttribute("value")),t.hasAttributeNS(null,"value")?e.type==="range"&&(e.value=n):e.removeAttribute("value"))}function ae(t,e){var n=t.value;if(n!==e.value&&(e.value=n),e.firstChild&&e.firstChild.nodeValue!==n){if(n===""&&e.firstChild.nodeValue===e.placeholder)return;e.firstChild.nodeValue=n}}function v(t,e,n){t[n]!==e[n]&&(e[n]=t[n],t[n]?e.setAttribute(n,""):e.removeAttribute(n))}});var D=m((Te,q)=>{var k=S(),ce=M(),se=3;q.exports=ue;function ue(t,e,n){return k.equal(typeof t,"object","nanomorph: oldTree should be an object"),k.equal(typeof e,"object","nanomorph: newTree should be an object"),n&&n.childrenOnly?(_(e,t),t):(k.notEqual(e.nodeType,11,"nanomorph: newTree should have one root node (which is not a DocumentFragment)"),d(e,t))}function d(t,e){return e?t?t.isSameNode&&t.isSameNode(e)?e:t.tagName!==e.tagName||V(t)!==V(e)?t:(ce(t,e),_(t,e),e):null:t}function V(t){return t.dataset?t.dataset.nanomorphComponentId:void 0}function _(t,e){for(var n,r,o,c,u=0,a=0;n=e.childNodes[a],r=t.childNodes[a-u],!(!n&&!r);a++)if(!r)e.removeChild(n),a--;else if(!n)e.appendChild(r),u++;else if(L(r,n))o=d(r,n),o!==n&&(e.replaceChild(o,n),u++);else{c=null;for(var s=a;s<e.childNodes.length;s++)if(L(e.childNodes[s],r)){c=e.childNodes[s];break}c?(o=d(r,c),o!==c&&u++,e.insertBefore(o,n)):!r.id&&!n.id?(o=d(r,n),o!==n&&(e.replaceChild(o,n),u++)):(e.insertBefore(r,n),u++)}}function L(t,e){return t.id?t.id===e.id:t.isSameNode?t.isSameNode(e):t.tagName!==e.tagName?!1:t.type===se?t.nodeValue===e.nodeValue:!1}});var g=J(D());window.magic={templates:new Map,socketrefs:new Map,socketrefs_refs:new Map,didRenderRoot:!1,socket:null,baseProps:["metaKey","ctrlKey","shiftKey"],themeColor:()=>{let t=document.querySelector('meta[name="theme-color"]');return t?t.attributes.getNamedItem("content").value:"rgb(59,130,246)"}};function H(){x();let t=new URLSearchParams(location.search);t.append("ws","0"),window.magic.socket=new WebSocket("ws://"+location.host+location.pathname+"?"+t),window.magic.socket.onopen=()=>{let e=window.magic;e.templates={},e.socketrefs={},e.socketrefs_refs={},e.didRenderRoot=!1},window.magic.socket.onmessage=e=>{be(),le(JSON.parse(e.data))},window.magic.socket.onclose=e=>{x(),setTimeout(H,1e3)},window.magic.socket.onerror=e=>{console.error("Socket encountered error: ",e,"Closing socket"),magic.socket.close()}}function le(t){let e=new Set;t.forEach(n=>{if(n.length===2&&typeof n[0]=="number")window.magic.templates[n[0]]=n[1],he(n[0]);else if(n.length===2&&fe(n[0])){let r=n[0];if(ye(r,n[1]),!window.magic.didRenderRoot)return;e.add(r)}}),e.forEach(n=>{pe(n)}),window.magic.didRenderRoot||((0,g.default)(document,y($())),h(document),window.magic.didRenderRoot=!0)}function fe(t){return typeof t=="string"}function b(t){return t&&t.length===2&&typeof t[0]=="string"}function $(){return E(window.magic.socketrefs[0]["#"])}function E(t){return me(`${t[0]}:${t[1]}`,window.magic.templates[t[1]],window.magic.socketrefs[t[0]])}function me(t,e,n){return ge(e,r=>{switch(r){case"magic:live":return de();case"magic:id":return`magic-id="${t}"`}if(n===void 0)return"";let o=n[r];return o==null?"":b(o)?E(o):o})}function de(){return"<script>"+document.head.children[0].innerHTML+"<\/script>"}function ge(t,e){return t.replace(/~.+?~/g,(n,r,o,c)=>e(n.slice(1,-1)))}function y(t){if(t.toLowerCase().trim().indexOf("<!doctype")===0){let r=document.implementation.createHTMLDocument("");return r.documentElement.innerHTML=t,r}else if("content"in document.createElement("template")){let r=document.createElement("template");return r.innerHTML=t,r.content}let e=document.createDocumentFragment(),n=document.createElement("body");for(n.innerHTML=t,i=0;0<n.childNodes.length;)e.appendChild(n.childNodes[i]);return e}function he(t){window.magic.templates[t]=window.magic.templates[t].replace(/<\w*(\s|>|\/>)/m,e=>e.endsWith("/>")?e.slice(0,-1)+" ~magic:id~/>":e.endsWith(">")?e.slice(0,-1)+" ~magic:id~>":e+"~magic:id~ ")}function pe(t){if(t===magic.socketrefs[0]["#"][0]){(0,g.default)(document,y($())),h(document),console.debug("[RENDERED]",document);return}document.querySelectorAll(`[magic-id^="${t}"]`).forEach(e=>{let n=y(E(e.attributes.getNamedItem("magic-id").value.split(":")));(0,g.default)(e,n.children[0]),h(e),console.debug("[RENDERED]",e)})}function h(t){ve(t);let e=t.attributes;if(e)for(let n=0;n<e.length;n++)e[n].name.startsWith("magic")&&we(t,e[n]);if(t.children)for(let n=0;n<t.children.length;n++)h(t.children[n])}function we(t,e){let n=e.name.slice(6),r=e.value,o=window.magic.baseProps;switch(n){case"click":t.onclick=f(n,[...o],r);return;case"focus":t.onfocus=f(n,[...o],r);return;case"change":t.onchange=f(n,[...o],r);return;case"keydown":t.onkeydown=f(n,[...o],r);return;case"keypress":t.onkeypress=f(n,[...o],r);return;case"keyup":t.onkeyup=f(n,[...o],r);return;case"submit":t.onsubmit=f(n,[...o],r);return;case"dblclick":t.ondblclick=f(n,[...o],r);return}}function ve(t){t.onclick=null,t.onfocus=null,t.onchange=null,t.onkeydown=null,t.onkeypress=null,t.onkeyup=null,t.onsubmit=null,t.ondblclick=null}function f(t,e,n){return r=>{if(window.magic.socket){let o=Number(U(r.target)),c=Object.assign(ke(r,e),{value:n});window.magic.socket.send(JSON.stringify({kind:t,target:o,payload:c}))}}}function ke(t,e,n){let r={},o=e.length;for(;o--;){let c=t[e[o]];c!==void 0&&(r[e[o]]=c)}return r}function x(){if(window.magic.topbar)return;let t=window.magic.themeColor(),e=document.createElement("div");e.style="position:fixed;overflow:hidden;top:0;left:0;width:100%";let n=document.createElement("div");n.style=`background-color:${t};height:.2rem;width:100%;opacity:0.4`;let r=document.createElement("div");r.style=`background-color:${t};position:absolute;bottom:0;top:0;width:50%`,e.appendChild(n),e.appendChild(r);let o=setTimeout(()=>{document.body.appendChild(e),r.animate([{left:"-50%"},{left:"100%"}],{duration:800,iterations:1/0})},120);e.destroy=()=>{clearInterval(o),e.remove()},window.magic.topbar=e}function be(){window.magic.topbar&&(window.magic.topbar.destroy(),window.magic.topbar=null)}function ye(t,e){let n=Object.keys(e),r=n.length;for(;r--;){let o=e[n[r]];b(o)&&P(o[0],1)}if(window.magic.socketrefs[t]===void 0){window.magic.socketrefs[t]=e;return}for(r=n.length;r--;){let o=window.magic.socketrefs[t][n[r]];b(o)&&P(o[0],-1)}Object.assign(window.magic.socketrefs[t],e)}function P(t,e){window.magic.socketrefs_refs[t]!==void 0?window.magic.socketrefs_refs[t]+=e:window.magic.socketrefs_refs[t]=e,e<0&&window.magic.socketrefs_refs[t]<1&&(delete window.magic.socketrefs[t],delete window.magic.socketrefs_refs[t])}function U(t){let e=t.attributes.getNamedItem("magic-id");return e!==null?e.value.split(":",1)[0]:t.parentNode?U(t):window.magic.socketrefs[0]["#"][0]}document.addEventListener("DOMContentLoaded",H);})();
