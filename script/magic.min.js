(()=>{var U=Object.create;var A=Object.defineProperty;var j=Object.getOwnPropertyDescriptor;var B=Object.getOwnPropertyNames;var W=Object.getPrototypeOf,K=Object.prototype.hasOwnProperty;var m=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports);var X=(n,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of B(e))!K.call(n,o)&&o!==t&&A(n,o,{get:()=>e[o],enumerable:!(r=j(e,o))||r.enumerable});return n};var J=(n,e,t)=>(t=n!=null?U(W(n)):{},X(e||!n||!n.__esModule?A(t,"default",{value:n,enumerable:!0}):t,n));var T=m((Ae,R)=>{f.notEqual=G;f.notOk=Q;f.equal=z;f.ok=f;R.exports=f;function z(n,e,t){f(n==e,t)}function G(n,e,t){f(n!=e,t)}function Q(n,e){f(!n,e)}function f(n,e){if(!n)throw new Error(e||"AssertionError")}});var S=m((Re,C)=>{C.exports=["onclick","ondblclick","onmousedown","onmouseup","onmouseover","onmousemove","onmouseout","onmouseenter","onmouseleave","ontouchcancel","ontouchend","ontouchmove","ontouchstart","ondragstart","ondrag","ondragenter","ondragleave","ondragover","ondrop","ondragend","onkeydown","onkeypress","onkeyup","onunload","onabort","onerror","onresize","onscroll","onselect","onchange","onsubmit","onreset","onfocus","onblur","oninput","onanimationend","onanimationiteration","onanimationstart","oncontextmenu","onfocusin","onfocusout"]});var _=m((Te,M)=>{var O=S(),Y=O.length,Z=1,N=3,ee=8;M.exports=ne;function ne(n,e){var t=n.nodeType,r=n.nodeName;t===Z&&te(n,e),(t===N||t===ee)&&e.nodeValue!==n.nodeValue&&(e.nodeValue=n.nodeValue),r==="INPUT"?oe(n,e):r==="OPTION"?re(n,e):r==="TEXTAREA"&&ce(n,e),ie(n,e)}function te(n,e){for(var t=e.attributes,r=n.attributes,o=null,c=null,u=null,s=null,a=null,p=r.length-1;p>=0;--p)a=r[p],s=a.name,o=a.namespaceURI,c=a.value,o?(s=a.localName||s,u=e.getAttributeNS(o,s),u!==c&&e.setAttributeNS(o,s,c)):e.hasAttribute(s)?(u=e.getAttribute(s),u!==c&&(c==="null"||c==="undefined"?e.removeAttribute(s):e.setAttribute(s,c))):e.setAttribute(s,c);for(var h=t.length-1;h>=0;--h)a=t[h],a.specified!==!1&&(s=a.name,o=a.namespaceURI,o?(s=a.localName||s,n.hasAttributeNS(o,s)||e.removeAttributeNS(o,s)):n.hasAttributeNS(null,s)||e.removeAttribute(s))}function ie(n,e){for(var t=0;t<Y;t++){var r=O[t];n[r]?e[r]=n[r]:e[r]&&(e[r]=void 0)}}function re(n,e){w(n,e,"selected")}function oe(n,e){var t=n.value,r=e.value;w(n,e,"checked"),w(n,e,"disabled"),n.indeterminate!==e.indeterminate&&(e.indeterminate=n.indeterminate),e.type!=="file"&&(t!==r&&(e.setAttribute("value",t),e.value=t),t==="null"&&(e.value="",e.removeAttribute("value")),n.hasAttributeNS(null,"value")?e.type==="range"&&(e.value=t):e.removeAttribute("value"))}function ce(n,e){var t=n.value;if(t!==e.value&&(e.value=t),e.firstChild&&e.firstChild.nodeValue!==t){if(t===""&&e.firstChild.nodeValue===e.placeholder)return;e.firstChild.nodeValue=t}}function w(n,e,t){n[t]!==e[t]&&(e[t]=n[t],n[t]?e.setAttribute(t,""):e.removeAttribute(t))}});var D=m((Ce,q)=>{var v=T(),se=_(),ae=3;q.exports=ue;function ue(n,e,t){return v.equal(typeof n,"object","nanomorph: oldTree should be an object"),v.equal(typeof e,"object","nanomorph: newTree should be an object"),t&&t.childrenOnly?(L(e,n),n):(v.notEqual(e.nodeType,11,"nanomorph: newTree should have one root node (which is not a DocumentFragment)"),d(e,n))}function d(n,e){return e?n?n.isSameNode&&n.isSameNode(e)?e:n.tagName!==e.tagName||V(n)!==V(e)?n:(se(n,e),L(n,e),e):null:n}function V(n){return n.dataset?n.dataset.nanomorphComponentId:void 0}function L(n,e){for(var t,r,o,c,u=0,s=0;t=e.childNodes[s],r=n.childNodes[s-u],!(!t&&!r);s++)if(!r)e.removeChild(t),s--;else if(!t)e.appendChild(r),u++;else if(I(r,t))o=d(r,t),o!==t&&(e.replaceChild(o,t),u++);else{c=null;for(var a=s;a<e.childNodes.length;a++)if(I(e.childNodes[a],r)){c=e.childNodes[a];break}c?(o=d(r,c),o!==c&&u++,e.insertBefore(o,t)):!r.id&&!t.id?(o=d(r,t),o!==t&&(e.replaceChild(o,t),u++)):(e.insertBefore(r,t),u++)}}function I(n,e){return n.id?n.id===e.id:n.isSameNode?n.isSameNode(e):n.tagName!==e.tagName?!1:n.type===ae?n.nodeValue===e.nodeValue:!1}});var H=J(D());window.magic={templates:new Map,socketrefs:new Map,socketrefs_refs:new Map,didRenderRoot:!1,socket:null,baseProps:["metaKey","ctrlKey","shiftKey"],themeColor:()=>{let n=document.querySelector('meta[name="theme-color"]');return n?n.attributes.getNamedItem("content").value:"rgb(59,130,246)"}};function $(){x();let n=new URLSearchParams(location.search);n.append("ws","0"),window.magic.socket=new WebSocket("ws://"+location.host+location.pathname+"?"+n),window.magic.socket.onopen=function(){window.magic.templates={},window.magic.socketrefs={},window.magic.socketrefs_refs={},window.magic.didRenderRoot=!1},window.magic.socket.onmessage=function(e){be(),fe(JSON.parse(e.data))},window.magic.socket.onclose=function(e){x(),setTimeout($,1e3)},window.magic.socket.onerror=function(e){console.error("Socket encountered error: ",e,"Closing socket"),magic.socket.close()}}function fe(n){let e=new Set;n.forEach(t=>{if(t.length===2&&typeof t[0]=="number")window.magic.templates[t[0]]=t[1],pe(t[0]);else if(t.length===2&&le(t[0])){let r=t[0];if(console.info(r,t[1]),ye(r,t[1]),!window.magic.didRenderRoot)return;e.add(r)}}),e.forEach(t=>{he(t)}),window.magic.didRenderRoot||(y(document,b(F())),g(document),window.magic.didRenderRoot=!0)}function le(n){return typeof n=="string"}function k(n){return n&&n.length===2&&typeof n[0]=="string"}function F(){let n=window.magic.socketrefs[0]["#"];return E(n)}function E(n){return me(`${n[0]}:${n[1]}`,window.magic.templates[n[1]],window.magic.socketrefs[n[0]])}function me(n,e,t){return ge(e,o=>{if(o==="magic:live")return de();if(o==="magic:id")return`magic-id="${n}"`;let c=t[o];return c==null?"":k(c)?E(c):c})}function de(){return"<script>"+document.head.children[0].innerHTML+"<\/script>"}function ge(n,e){return n.replace(/~.+?~/g,(t,r,o,c)=>e(t.slice(1,-1)))}function b(n){if(n.toLowerCase().trim().indexOf("<!doctype")===0){let e=document.implementation.createHTMLDocument("");return e.documentElement.innerHTML=n,e}else if("content"in document.createElement("template")){let e=document.createElement("template");return e.innerHTML=n,e.content}else{let e=document.createDocumentFragment(),t=document.createElement("body");for(t.innerHTML=n,i=0;0<t.childNodes.length;)e.appendChild(t.childNodes[i]);return e}}function y(n,e){(0,H.default)(n,e)}function pe(n){window.magic.templates[n]=window.magic.templates[n].replace(/<\w*(\s|>|\/>)/m,(e,t,r,o)=>e.endsWith("/>")?e.slice(0,-1)+" ~magic:id~/>":e.endsWith(">")?e.slice(0,-1)+" ~magic:id~>":e+"~magic:id~ ")}function he(n){if(n===magic.socketrefs[0]["#"][0]){y(document,b(F())),g(document),console.debug("[RENDERED]",document);return}document.querySelectorAll(`[magic-id^="${n}"]`).forEach(e=>{let t=b(E(e.attributes.getNamedItem("magic-id").value.split(":")));y(e,t.children[0]),g(e),console.debug("[RENDERED]",e)})}function g(n){ve(n);let e=n.attributes;if(e)for(let t=0;t<e.length;t++)e[t].name.startsWith("magic")&&we(n,e[t]);if(n.children)for(let t=0;t<n.children.length;t++)g(n.children[t])}function we(n,e){let t=e.name.slice(6),r=e.value,o=window.magic.baseProps;switch(t){case"click":n.onclick=l(t,[...o],r);return;case"focus":n.onfocus=l(t,[...o],r);return;case"change":n.onchange=l(t,[...o],r);return;case"keydown":n.onkeydown=l(t,[...o],r);return;case"keypress":n.onkeypress=l(t,[...o],r);return;case"keyup":n.onkeyup=l(t,[...o],r);return;case"submit":n.onsubmit=l(t,[...o],r);return;case"dblclick":n.ondblclick=l(t,[...o],r);return}}function ve(n){n.onclick=null,n.onfocus=null,n.onchange=null,n.onkeydown=null,n.onkeypress=null,n.onkeyup=null,n.onsubmit=null,n.ondblclick=null}function l(n,e,t){return r=>{let o=Object.assign(ke(r,e),{value:t});window.magic.socket&&window.magic.socket.send(JSON.stringify({kind:n,payload:o}))}}function ke(n,e,t){let r={};for(let o=0;o<e.length;o++){let c=n[e[o]];c!==void 0&&(r[e[o]]=c)}return r}function x(){if(window.magic.topbar)return;let n=window.magic.themeColor(),e=document.createElement("div");e.style="position:fixed;overflow:hidden;top:0;left:0;width:100%";let t=document.createElement("div");t.style=`background-color:${n};height:.2rem;width:100%;opacity:0.4`;let r=document.createElement("div");r.style=`background-color:${n};position:absolute;bottom:0;top:0;width:50%`,e.appendChild(t),e.appendChild(r);let o=setTimeout(()=>{document.body.appendChild(e),r.animate([{left:"-50%"},{left:"100%"}],{duration:800,iterations:1/0})},120);e.destroy=()=>{clearInterval(o),e.remove()},window.magic.topbar=e}function be(){window.magic.topbar&&(window.magic.topbar.destroy(),window.magic.topbar=null)}function ye(n,e){let t=Object.keys(e),r=t.length;for(;r--;){let o=e[t[r]];k(o)&&P(o[0],1)}if(window.magic.socketrefs[n]===void 0)window.magic.socketrefs[n]=e;else{for(r=t.length;r--;){let o=window.magic.socketrefs[n][t[r]];k(o)&&P(o[0],-1)}Object.assign(window.magic.socketrefs[n],e)}}function P(n,e){window.magic.socketrefs_refs[n]!==void 0?window.magic.socketrefs_refs[n]+=e:window.magic.socketrefs_refs[n]=e,e<0&&window.magic.socketrefs_refs[n]<1&&(console.info(delete window.magic.socketrefs[n]),console.info(delete window.magic.socketrefs_refs[n]),console.log("Found orphan and removed it:",n,Object.keys(window.magic.socketrefs_refs).length,Object.keys(window.magic.socketrefs).length))}document.addEventListener("DOMContentLoaded",$);})();
