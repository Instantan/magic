(()=>{var B=Object.create;var S=Object.defineProperty;var W=Object.getOwnPropertyDescriptor;var X=Object.getOwnPropertyNames;var K=Object.getPrototypeOf,J=Object.prototype.hasOwnProperty;var g=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var j=(e,t,n,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of X(t))!J.call(e,a)&&a!==n&&S(e,a,{get:()=>t[a],enumerable:!(r=W(t,a))||r.enumerable});return e};var z=(e,t,n)=>(n=e!=null?B(K(e)):{},j(t||!e||!e.__esModule?S(n,"default",{value:e,enumerable:!0}):n,e));var R=g((Ce,C)=>{l.notEqual=Q;l.notOk=Y;l.equal=G;l.ok=l;C.exports=l;function G(e,t,n){l(e==t,n)}function Q(e,t,n){l(e!=t,n)}function Y(e,t){l(!e,t)}function l(e,t){if(!e)throw new Error(t||"AssertionError")}});var V=g((Re,O)=>{O.exports=["onclick","ondblclick","onmousedown","onmouseup","onmouseover","onmousemove","onmouseout","onmouseenter","onmouseleave","ontouchcancel","ontouchend","ontouchmove","ontouchstart","ondragstart","ondrag","ondragenter","ondragleave","ondragover","ondrop","ondragend","onkeydown","onkeypress","onkeyup","onunload","onabort","onerror","onresize","onscroll","onselect","onchange","onsubmit","onreset","onfocus","onblur","oninput","onanimationend","onanimationiteration","onanimationstart","oncontextmenu","onfocusin","onfocusout"]});var L=g((Oe,M)=>{var I=V(),Z=I.length,N=1,ee=3,te=8;M.exports=ne;function ne(e,t){var n=e.nodeType,r=e.nodeName;n===N&&ie(e,t),(n===ee||n===te)&&t.nodeValue!==e.nodeValue&&(t.nodeValue=e.nodeValue),r==="INPUT"?oe(e,t):r==="OPTION"?ae(e,t):r==="TEXTAREA"&&ce(e,t),re(e,t)}function ie(e,t){for(var n=t.attributes,r=e.attributes,a=null,o=null,s=null,c=null,u=null,k=r.length-1;k>=0;--k)u=r[k],c=u.name,a=u.namespaceURI,o=u.value,a?(c=u.localName||c,s=t.getAttributeNS(a,c),s!==o&&t.setAttributeNS(a,c,o)):t.hasAttribute(c)?(s=t.getAttribute(c),s!==o&&(o==="null"||o==="undefined"?t.removeAttribute(c):t.setAttribute(c,o))):t.setAttribute(c,o);for(var b=n.length-1;b>=0;--b)u=n[b],u.specified!==!1&&(c=u.name,a=u.namespaceURI,a?(c=u.localName||c,e.hasAttributeNS(a,c)||t.removeAttributeNS(a,c)):e.hasAttributeNS(null,c)||t.removeAttribute(c))}function re(e,t){for(var n=0;n<Z;n++){var r=I[n];e[r]?t[r]=e[r]:t[r]&&(t[r]=void 0)}}function ae(e,t){y(e,t,"selected")}function oe(e,t){var n=e.value,r=t.value;y(e,t,"checked"),y(e,t,"disabled"),e.indeterminate!==t.indeterminate&&(t.indeterminate=e.indeterminate),t.type!=="file"&&(n!==r&&(t.setAttribute("value",n),t.value=n),n==="null"&&(t.value="",t.removeAttribute("value")),e.hasAttributeNS(null,"value")?t.type==="range"&&(t.value=n):t.removeAttribute("value"))}function ce(e,t){var n=e.value;if(n!==t.value&&(t.value=n),t.firstChild&&t.firstChild.nodeValue!==n){if(n===""&&t.firstChild.nodeValue===t.placeholder)return;t.firstChild.nodeValue=n}}function y(e,t,n){e[n]!==t[n]&&(t[n]=e[n],e[n]?t.setAttribute(n,""):t.removeAttribute(n))}});var D=g((Ve,x)=>{var E=R(),se=L(),ue=3;x.exports=le;function le(e,t,n){return E.equal(typeof e,"object","nanomorph: oldTree should be an object"),E.equal(typeof t,"object","nanomorph: newTree should be an object"),n&&n.childrenOnly?(P(t,e),e):(E.notEqual(t.nodeType,11,"nanomorph: newTree should have one root node (which is not a DocumentFragment)"),h(t,e))}function h(e,t){return t?e?e.isSameNode&&e.isSameNode(t)?t:e.tagName!==t.tagName||_(e)!==_(t)?e:(se(e,t),P(e,t),t):null:e}function _(e){return e.dataset?e.dataset.nanomorphComponentId:void 0}function P(e,t){for(var n,r,a,o,s=0,c=0;n=t.childNodes[c],r=e.childNodes[c-s],!(!n&&!r);c++)if(!r)t.removeChild(n),c--;else if(!n)t.appendChild(r),s++;else if(q(r,n))a=h(r,n),a!==n&&(t.replaceChild(a,n),s++);else{o=null;for(var u=c;u<t.childNodes.length;u++)if(q(t.childNodes[u],r)){o=t.childNodes[u];break}o?(a=h(r,o),a!==o&&s++,t.insertBefore(a,n)):!r.id&&!n.id?(a=h(r,n),a!==n&&(t.replaceChild(a,n),s++)):(t.insertBefore(r,n),s++)}}function q(e,t){return e.id?e.id===t.id:e.isSameNode?e.isSameNode(t):e.tagName!==t.tagName?!1:e.type===ue?e.nodeValue===t.nodeValue:!1}});var p=z(D());window.magic={templates:new Map,socketrefs:new Map,socketrefs_refs:new Map,didRenderRoot:!1,socket:null,baseProps:["metaKey","ctrlKey","shiftKey"],keyboardProps:["key","content"],themeColor:()=>{let e=document.querySelector('meta[name="theme-color"]');return e?e.attributes.getNamedItem("content").value:"rgb(59,130,246)"}};function U(){H();let e=new URLSearchParams(location.search);e.append("ws","0"),window.magic.socket=new WebSocket("ws://"+location.host+location.pathname+"?"+e),window.magic.socket.onopen=()=>{let t=window.magic;t.templates={},t.socketrefs={},t.socketrefs_refs={},t.didRenderRoot=!1},window.magic.socket.onmessage=t=>{ye(),fe(JSON.parse(t.data))},window.magic.socket.onclose=t=>{H(),setTimeout(U,1e3)},window.magic.socket.onerror=t=>{console.error("Socket encountered error: ",t,"Closing socket"),magic.socket.close()}}function fe(e){let t=new Set;e.forEach(n=>{if(n.length===2&&typeof n[0]=="number")window.magic.templates[n[0]]=n[1],pe(n[0]);else if(n.length===2&&me(n[0])){let r=n[0];if(Ee(r,n[1]),!window.magic.didRenderRoot)return;t.add(r)}}),t.forEach(n=>{we(n)}),window.magic.didRenderRoot||((0,p.default)(document,T($())),v(document),window.magic.didRenderRoot=!0)}function me(e){return typeof e=="string"}function d(e){return e&&e.length===2&&typeof e[0]=="string"}function A(e){return e&&Array.isArray(e)&&e.length>0&&d(e[0])}function $(){return w(window.magic.socketrefs[0]["#"])}function w(e){return de(`${e[0]}:${e[1]}`,window.magic.templates[e[1]],window.magic.socketrefs[e[0]])}function de(e,t,n){return he(t,r=>{switch(r){case"magic:live":return ge();case"magic:id":return`magic-id="${e}"`}if(n===void 0)return"";let a=n[r];if(a==null)return"";if(d(a))return w(a);if(A(a)){let o="";for(let s=0;s<a.length;s++)o+=w(a[s]);return o}return a})}function ge(){return"<script>"+document.head.children[0].innerHTML+"<\/script>"}function he(e,t){return e.replace(/~.+?~/g,(n,r,a,o)=>t(n.slice(1,-1)))}function T(e){if(e.toLowerCase().trim().indexOf("<!doctype")===0){let r=document.implementation.createHTMLDocument("");return r.documentElement.innerHTML=e,r}else if("content"in document.createElement("template")){let r=document.createElement("template");return r.innerHTML=e,r.content}let t=document.createDocumentFragment(),n=document.createElement("body");for(n.innerHTML=e,i=0;0<n.childNodes.length;)t.appendChild(n.childNodes[i]);return t}function pe(e){window.magic.templates[e]=window.magic.templates[e].replace(/<\w*(\s|>|\/>)/m,t=>t.endsWith("/>")?t.slice(0,-1)+" ~magic:id~/>":t.endsWith(">")?t.slice(0,-1)+" ~magic:id~>":t+"~magic:id~ ")}function we(e){if(e===magic.socketrefs[0]["#"][0]){(0,p.default)(document,v(T($())));return}document.querySelectorAll(`[magic-id^="${e}"]`).forEach(t=>{let n=T(w(t.attributes.getNamedItem("magic-id").value.split(":")));(0,p.default)(t,v(n.children[0]))})}function v(e){ke(e);let t=e.attributes;switch(e.nodeName){case"TEXTAREA":case"INPUT":e.isSameNode=Te}if(t)for(let n=0;n<t.length;n++)t[n].name.startsWith("magic")&&ve(e,t[n]);if(e.children)for(let n=0;n<e.children.length;n++)v(e.children[n]);return e}function ve(e,t){let n=t.name.slice(6),r=t.value,a=window.magic.baseProps,o=window.magic.keyboardProps;switch(n){case"click":e.onclick=f(n,[...a],r);return;case"focus":e.onfocus=f(n,[...a],r);return;case"change":e.onchange=f(n,[...a,...o],r);return;case"keydown":e.onkeydown=f(n,[...a,...o],r);return;case"keypress":e.onkeypress=f(n,[...a,...o],r);return;case"keyup":e.onkeyup=f(n,[...a,...o],r);return;case"submit":e.onsubmit=f(n,[...a],r);return;case"dblclick":e.ondblclick=f(n,[...a],r);return}}function ke(e){e.onclick=null,e.onfocus=null,e.onchange=null,e.onkeydown=null,e.onkeypress=null,e.onkeyup=null,e.onsubmit=null,e.ondblclick=null}function f(e,t,n){return r=>{if(window.magic.socket){let a=Number(F(r.target)),o=Object.assign(be(r,t),{value:n});window.magic.socket.send(JSON.stringify({kind:e,target:a,payload:o}))}}}function be(e,t,n){let r={},a=t.length;for(;a--;){let o=t[a]==="content"?e.value===void 0?e.target.value:e.value:e[t[a]];o!==void 0&&(r[t[a]]=o)}return r}function H(){if(window.magic.topbar)return;let e=window.magic.themeColor(),t=document.createElement("div");t.style="position:fixed;overflow:hidden;top:0;left:0;width:100%";let n=document.createElement("div");n.style=`background-color:${e};height:.2rem;width:100%;opacity:0.4`;let r=document.createElement("div");r.style=`background-color:${e};position:absolute;bottom:0;top:0;width:50%`,t.appendChild(n),t.appendChild(r);let a=setTimeout(()=>{document.body.appendChild(t),r.animate([{left:"-50%"},{left:"100%"}],{duration:800,iterations:1/0})},120);t.destroy=()=>{clearInterval(a),t.remove()},window.magic.topbar=t}function ye(){window.magic.topbar&&(window.magic.topbar.destroy(),window.magic.topbar=null)}function Ee(e,t){console.log(Object.keys(window.magic.socketrefs).length);let n=Object.keys(t),r=n.length;for(;r--;){let a=t[n[r]];if(d(a))m(a[0],1);else if(A(a))for(let o=0;o<a.length;o++)m(a[o][0],1)}if(window.magic.socketrefs[e]===void 0){window.magic.socketrefs[e]=t;return}for(r=n.length;r--;){let a=window.magic.socketrefs[e][n[r]];if(d(a))m(a[0],-1);else if(A(a))for(let o=0;o<a.length;o++)m(a[o][0],-1)}Object.assign(window.magic.socketrefs[e],t)}function m(e,t){window.magic.socketrefs_refs[e]!==void 0?window.magic.socketrefs_refs[e]+=t:window.magic.socketrefs_refs[e]=t,t<0&&Ae(e,t),window.magic.socketrefs_refs[e]<1&&(delete window.magic.socketrefs[e],delete window.magic.socketrefs_refs[e])}function Ae(e,t){let n=window.magic.socketrefs[e];Object.keys(n).forEach(r=>{let a=n[r];d(a)&&m(a[0],t)})}function F(e){if(e){if(e.attributes){let t=e.attributes.getNamedItem("magic-id");if(t!==null)return t.value.split(":",1)[0]}if(e.parentNode)return F(e.parentNode)}return window.magic.socketrefs[0]["#"][0]}function Te(e){let t=this;return e.prevValue===void 0||e.prevValue!==t.value?e.prevValue=t.value:t.value=e.value,!1}document.addEventListener("DOMContentLoaded",U);})();
