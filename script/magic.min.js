(()=>{var z=Object.create;var q=Object.defineProperty;var G=Object.getOwnPropertyDescriptor;var Q=Object.getOwnPropertyNames;var Y=Object.getPrototypeOf,Z=Object.prototype.hasOwnProperty;var d=(t,n)=>()=>(n||t((n={exports:{}}).exports,n),n.exports);var N=(t,n,r,s)=>{if(n&&typeof n=="object"||typeof n=="function")for(let c of Q(n))!Z.call(t,c)&&c!==r&&q(t,c,{get:()=>n[c],enumerable:!(s=G(n,c))||s.enumerable});return t};var ee=(t,n,r)=>(r=t!=null?z(Y(t)):{},N(n||!t||!t.__esModule?q(r,"default",{value:t,enumerable:!0}):r,t));var x=d((Me,I)=>{m.notEqual=ne;m.notOk=re;m.equal=te;m.ok=m;I.exports=m;function te(t,n,r){m(t==n,r)}function ne(t,n,r){m(t!=n,r)}function re(t,n){m(!t,n)}function m(t,n){if(!t)throw new Error(n||"AssertionError")}});var L=d((Ue,V)=>{V.exports=["onclick","ondblclick","onmousedown","onmouseup","onmouseover","onmousemove","onmouseout","onmouseenter","onmouseleave","ontouchcancel","ontouchend","ontouchmove","ontouchstart","ondragstart","ondrag","ondragenter","ondragleave","ondragover","ondrop","ondragend","onkeydown","onkeypress","onkeyup","onunload","onabort","onerror","onresize","onscroll","onselect","onchange","onsubmit","onreset","onfocus","onblur","oninput","onanimationend","onanimationiteration","onanimationstart","oncontextmenu","onfocusin","onfocusout"]});var M=d(($e,D)=>{var P=L(),ie=P.length,se=1,ce=3,ae=8;D.exports=oe;function oe(t,n){var r=t.nodeType,s=t.nodeName;r===se&&ue(t,n),(r===ce||r===ae)&&n.nodeValue!==t.nodeValue&&(n.nodeValue=t.nodeValue),s==="INPUT"?me(t,n):s==="OPTION"?fe(t,n):s==="TEXTAREA"&&pe(t,n),le(t,n)}function ue(t,n){for(var r=n.attributes,s=t.attributes,c=null,o=null,u=null,l=null,f=null,S=s.length-1;S>=0;--S)f=s[S],l=f.name,c=f.namespaceURI,o=f.value,c?(l=f.localName||l,u=n.getAttributeNS(c,l),u!==o&&n.setAttributeNS(c,l,o)):n.hasAttribute(l)?(u=n.getAttribute(l),u!==o&&(o==="null"||o==="undefined"?n.removeAttribute(l):n.setAttribute(l,o))):n.setAttribute(l,o);for(var R=r.length-1;R>=0;--R)f=r[R],f.specified!==!1&&(l=f.name,c=f.namespaceURI,c?(l=f.localName||l,t.hasAttributeNS(c,l)||n.removeAttributeNS(c,l)):t.hasAttributeNS(null,l)||n.removeAttribute(l))}function le(t,n){for(var r=0;r<ie;r++){var s=P[r];t[s]?n[s]=t[s]:n[s]&&(n[s]=void 0)}}function fe(t,n){T(t,n,"selected")}function me(t,n){var r=t.value,s=n.value;T(t,n,"checked"),T(t,n,"disabled"),t.indeterminate!==n.indeterminate&&(n.indeterminate=t.indeterminate),n.type!=="file"&&(r!==s&&(n.setAttribute("value",r),n.value=r),r==="null"&&(n.value="",n.removeAttribute("value")),t.hasAttributeNS(null,"value")?n.type==="range"&&(n.value=r):n.removeAttribute("value"))}function pe(t,n){var r=t.value;if(r!==n.value&&(n.value=r),n.firstChild&&n.firstChild.nodeValue!==r){if(r===""&&n.firstChild.nodeValue===n.placeholder)return;n.firstChild.nodeValue=r}}function T(t,n,r){t[r]!==n[r]&&(n[r]=t[r],t[r]?n.setAttribute(r,""):n.removeAttribute(r))}});var W=d((Be,H)=>{var C=x(),he=M(),de=3;H.exports=ge;function ge(t,n,r){return C.equal(typeof t,"object","nanomorph: oldTree should be an object"),C.equal(typeof n,"object","nanomorph: newTree should be an object"),r&&r.childrenOnly?(B(n,t),t):(C.notEqual(n.nodeType,11,"nanomorph: newTree should have one root node (which is not a DocumentFragment)"),g(n,t))}function g(t,n){return n?t?t.isSameNode&&t.isSameNode(n)?n:t.tagName!==n.tagName||U(t)!==U(n)?t:(he(t,n),B(t,n),n):null:t}function U(t){return t.dataset?t.dataset.nanomorphComponentId:void 0}function B(t,n){for(var r,s,c,o,u=0,l=0;r=n.childNodes[l],s=t.childNodes[l-u],!(!r&&!s);l++)if(!s)n.removeChild(r),l--;else if(!r)n.appendChild(s),u++;else if($(s,r))c=g(s,r),c!==r&&(n.replaceChild(c,r),u++);else{o=null;for(var f=l;f<n.childNodes.length;f++)if($(n.childNodes[f],s)){o=n.childNodes[f];break}o?(c=g(s,o),c!==o&&u++,n.insertBefore(c,r)):!s.id&&!r.id?(c=g(s,r),c!==r&&(n.replaceChild(c,r),u++)):(n.insertBefore(s,r),u++)}}function $(t,n){return t.id?t.id===n.id:t.isSameNode?t.isSameNode(n):t.tagName!==n.tagName?!1:t.type===de?t.nodeValue===n.nodeValue:!1}});var y=ee(W());window.magic={templates:{},refs:{},didRenderRoot:!1,socket:null,baseProps:["metaKey","ctrlKey","shiftKey"],keyboardProps:["key","content"],themeColor:()=>{let t=document.querySelector('meta[name="theme-color"]');return t?t.attributes.getNamedItem("content").value:"rgb(59,130,246)"}};var a=window.magic;function w(t=""){X(),p("connecting");let n=a.socket;if(typeof t!="string"||t===""){let r=new URL(location.host+location.pathname);r.searchParams=new URLSearchParams(location.search),t=r.toString()}a.socket=new WebSocket((window.location.protocol==="https:"?"wss://":"ws://")+t),a.socket.onopen=()=>{n&&n.close(),a.templates={},a.refs={},a.didRenderRoot=!1},a.socket.onmessage=r=>{Oe(),p("connected"),ve(JSON.parse(r.data))},a.socket.onclose=r=>{a.socket&&r.srcElement.url!==a.socket.url||(X(),p("disconnected"),setTimeout(w,1e3))},a.socket.onerror=r=>{console.error("Error: ",r,"Closing socket"),a.socket.close()}}function ve(t){let n=new Set;t.forEach(r=>{if(r.length===2&&typeof r[0]=="number")a.templates[r[0]]=r[1],Se(r[0]);else if(r.length===2&&typeof r[0]=="string"){let s=r[0];if(we(s,r[1]),!a.didRenderRoot)return;n.add(s)}else xe(r)}),n.forEach(Re),a.didRenderRoot||(h(document),(0,y.default)(document,p("connected",O(_())),{childrenOnly:!0}),h(document),a.didRenderRoot=!0),ke()}function E(t){return t&&t.length===2&&!isNaN(t[1])}function be(t){return t&&Array.isArray(t)&&t.length>0&&E(t[0])}function _(){return A(a.refs[0]["#"])}function ke(){let t=a.refs,n=new Set(Object.keys(t));F(n,t,"0"),n.forEach(r=>delete t[r])}function F(t,n,r){t.delete(r);let s=n[r];if(s)for(let c in s){let o=s[c];if(Array.isArray(o)){if(E(o))F(t,n,o[0]);else if(E(o[0]))for(let u=0;u<o.length;u++)F(t,n,o[u][0])}}}function A(t){return ye(`${t[0]}:${t[1]}`,a.templates[t[1]],a.refs[t[0]])}function ye(t,n,r){return Ae(n,s=>{switch(s){case"magic:inject":return Ee();case"magic-id":return s+`="${t}"`}if(r===void 0||r[s]===void 0||r[s]===null)return"";let c=r[s];if(E(c))return A(c);if(be(c)){let o="";for(let u=0;u<c.length;u++)o+=A(c[u]);return o}return c})}function Ee(){return Array.of(...document.head.children).filter(t=>t.hasAttribute("magic:inject")).map(t=>{let n=document.createElement("div");return n.appendChild(t),n.innerHTML}).join("")}function Ae(t,n){return t.replace(/~.+?~/g,r=>n(r.slice(1,-1)))}function O(t){if(t.toLowerCase().trim().indexOf("<!doctype")===0){let s=document.implementation.createHTMLDocument("");return s.documentElement.innerHTML=t,s}else if("content"in k("template")){let s=k("template");return s.innerHTML=t,s.content}let n=document.createDocumentFragment(),r=k("body");for(r.innerHTML=t,i=0;0<r.childNodes.length;)n.appendChild(r.childNodes[i]);return n}function Se(t){a.templates[t]=a.templates[t].replace(/<\w*(\s|>|\/>)/m,n=>{let r=" ~magic-id~ ";return n.endsWith("/>")?n.slice(0,-1)+r+"/>":n.endsWith(">")?n.slice(0,-1)+r+">":n+r})}function Re(t){if(t===magic.refs[0]["#"][0]){(0,y.default)(document,h(p("connected",O(_()))),{childrenOnly:!0});return}document.querySelectorAll(`[magic-id^="${t}"]`).forEach(n=>{(0,y.default)(n,h(O(A(n.attributes.getNamedItem("magic-id").value.split(":"))).children[0]))})}function h(t){Ce(t);let n=t.attributes;switch(t.nodeName){case"TEXTAREA":case"INPUT":t.isSameNode=qe}if(n)for(let r=0;r<n.length;r++)n[r].name.startsWith("magic:")&&Te(t,n[r]);if(t.children)for(let r=0;r<t.children.length;r++)h(t.children[r]);return t}function Te(t,n){let r=n.name.slice(6),s=n.value,c=a.baseProps,o=a.keyboardProps,u="on"+r;switch(r){case"click":case"focus":t[u]=v(r,[...c],s);return;case"change":case"keydown":case"keypress":case"keyup":t[u]=v(r,[...c,...o],s);return;case"submit":t[u]=v(r,[...c,"form"],s,K);return;case"dblclick":t[u]=v(r,[...c],s);return;case"patch":t[u]=Ie;return;case"static":t.isSameNode=l=>{let f=l.attributes.getNamedItem("magic:static");return!!(f&&f.value===s)};return}}function Ce(t){t.onclick=t.onfocus=t.onchange=t.onkeydown=t.onkeypress=t.onkeyup=t.onsubmit=t.ondblclick=null}function v(t,n,r,s){return t="m:"+t,c=>{if(a.socket&&(console.log(c),a.socket.send(JSON.stringify({k:t,t:Number(j(c.target)),p:Object.assign(Fe(c,n),{value:r})}))),typeof s=="function")return s(c)}}function Fe(t,n,r){let s={},c=n.length;for(;c--;){let o=n[c]==="form"?Object.fromEntries(new FormData(t.srcElement).entries()):n[c]==="content"?t.value===void 0?t.target.value:t.value:t[n[c]];o!==void 0&&(s[n[c]]=o)}return s}function X(){if(a.topbar)return;let t=u=>{let l=k("div");return l.style.cssText=u,l},n=(u,l)=>u.appendChild(l),r=a.themeColor(),s=t("position:fixed;overflow:hidden;top:0;left:0;width:100%"),c=t(`background-color:${r};position:absolute;bottom:0;top:0;width:50%`);n(s,t(`background-color:${r};height:.2rem;width:100%;opacity:0.4`)),n(s,c);let o=setTimeout(()=>{n(document.body,s),c.animate([{left:"-50%"},{left:"100%"}],{duration:800,iterations:1/0})},120);s.destroy=()=>{clearInterval(o),s.remove()},a.topbar=s}function Oe(){a.topbar&&(a.topbar.destroy(),a.topbar=null)}function we(t,n){if(a.refs[t]===void 0){a.refs[t]=n;return}Object.assign(a.refs[t],n)}function j(t){if(t&&t.attributes){let n=t.attributes.getNamedItem("magic-id");if(n!==null)return n.value.split(":",1)[0]}return t&&t.parentNode?j(t.parentNode):a.refs[0]["#"][0]}function qe(t){let n=this;return t.prevValue===void 0||t.prevValue!==n.value?t.prevValue=n.value:n.value=t.value,!1}function Ie(t){let n=t.srcElement.attributes.getNamedItem("href").value+"";return J(n),K(t)}function K(t){return t.preventDefault?t.preventDefault():t.stopPropagation&&t.stopPropagation(),!1}function J(t){let n=t.startsWith("/")?location.host+t:t;w(n),history.pushState({},"",t)}function p(t,n=document){if(n.children.length===0)return;let r=n.children[0],s="magic-"+t;if(!r.classList.contains(s))return["connected","connecting","disconnected"].forEach(c=>r.classList.remove("magic-"+c)),r.classList.add(s),n}function xe(t){if(t.k.startsWith("m:"))switch(t.k=t.k.slice(2),t.k){case"navigate":a.socket&&(a.socket.onclose=void 0),J(t.p);return;case"reset":case"click":case"blur":case"submit":b(t.p,t.t,t.k);return;case"animate":b(t.p.ids,t.t,t.k,t.p.args.keyframes,t.p.args.options?t.p.args.options:t.p.args.duration);return;case"scrollIntoView":b(t.p.ids,t.t,t.k,t.p.args.options?t.p.args.options:t.p.args.alignToTop);return;case"openFullscreen":Ve();return;case"closeFullscreen":Le();return;case"disconnect":a.socket&&(a.socket.onclose=void 0,a.socket.close(),p("disconnected"));return;case"updateUrl":history.pushState({},"",t.p);case"refreshFile":b(t.p,t.t,Pe);return}let n=new CustomEvent(t.k,{target:t.t,detail:t.p});document.querySelectorAll(`[magic-id^="${t.t}"]`).forEach(r=>r.dispatchEvent(n)),window.dispatchEvent(n)}function k(t){return document.createElement(t)}function b(t=[],n=null,r="",...s){let c=o=>{try{typeof r=="function"?r(o):o&&o[r]&&o[r](...s)}catch(u){console.error(u)}};t.forEach(o=>c(document.getElementById(o))),t.length===0&&document.querySelectorAll(`[magic-id^="${e.t}"]`).forEach(c)}function Ve(){document.requestFullscreen?document.requestFullscreen():elem.webkitRequestFullscreen?document.webkitRequestFullscreen():elem.msRequestFullscreen&&document.msRequestFullscreen()}function Le(){document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen()}function Pe(t){if(t.src){let n=t.src.includes("?")&&!t.src.includes("?t=")?"&t=":"?t=",r=t.src;r.indexOf(n)!=-1&&(r=r.split(n)[0]),t.src=r+n+Date.now()}}document.addEventListener("DOMContentLoaded",w);})();
