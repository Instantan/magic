(()=>{var $=Object.create;var E=Object.defineProperty;var U=Object.getOwnPropertyDescriptor;var B=Object.getOwnPropertyNames;var W=Object.getPrototypeOf,F=Object.prototype.hasOwnProperty;var m=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var K=(t,e,n,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of B(e))!F.call(t,o)&&o!==n&&E(t,o,{get:()=>e[o],enumerable:!(r=U(e,o))||r.enumerable});return t};var X=(t,e,n)=>(n=t!=null?$(W(t)):{},K(e||!t||!t.__esModule?E(n,"default",{value:t,enumerable:!0}):n,t));var A=m((ye,R)=>{f.notEqual=j;f.notOk=z;f.equal=J;f.ok=f;R.exports=f;function J(t,e,n){f(t==e,n)}function j(t,e,n){f(t!=e,n)}function z(t,e){f(!t,e)}function f(t,e){if(!t)throw new Error(e||"AssertionError")}});var T=m((Ee,S)=>{S.exports=["onclick","ondblclick","onmousedown","onmouseup","onmouseover","onmousemove","onmouseout","onmouseenter","onmouseleave","ontouchcancel","ontouchend","ontouchmove","ontouchstart","ondragstart","ondrag","ondragenter","ondragleave","ondragover","ondrop","ondragend","onkeydown","onkeypress","onkeyup","onunload","onabort","onerror","onresize","onscroll","onselect","onchange","onsubmit","onreset","onfocus","onblur","oninput","onanimationend","onanimationiteration","onanimationstart","oncontextmenu","onfocusin","onfocusout"]});var V=m((Re,O)=>{var C=T(),G=C.length,Q=1,Y=3,Z=8;O.exports=N;function N(t,e){var n=t.nodeType,r=t.nodeName;n===Q&&ee(t,e),(n===Y||n===Z)&&e.nodeValue!==t.nodeValue&&(e.nodeValue=t.nodeValue),r==="INPUT"?ie(t,e):r==="OPTION"?ne(t,e):r==="TEXTAREA"&&re(t,e),te(t,e)}function ee(t,e){for(var n=e.attributes,r=t.attributes,o=null,a=null,u=null,c=null,s=null,g=r.length-1;g>=0;--g)s=r[g],c=s.name,o=s.namespaceURI,a=s.value,o?(c=s.localName||c,u=e.getAttributeNS(o,c),u!==a&&e.setAttributeNS(o,c,a)):e.hasAttribute(c)?(u=e.getAttribute(c),u!==a&&(a==="null"||a==="undefined"?e.removeAttribute(c):e.setAttribute(c,a))):e.setAttribute(c,a);for(var h=n.length-1;h>=0;--h)s=n[h],s.specified!==!1&&(c=s.name,o=s.namespaceURI,o?(c=s.localName||c,t.hasAttributeNS(o,c)||e.removeAttributeNS(o,c)):t.hasAttributeNS(null,c)||e.removeAttribute(c))}function te(t,e){for(var n=0;n<G;n++){var r=C[n];t[r]?e[r]=t[r]:e[r]&&(e[r]=void 0)}}function ne(t,e){v(t,e,"selected")}function ie(t,e){var n=t.value,r=e.value;v(t,e,"checked"),v(t,e,"disabled"),t.indeterminate!==e.indeterminate&&(e.indeterminate=t.indeterminate),e.type!=="file"&&(n!==r&&(e.setAttribute("value",n),e.value=n),n==="null"&&(e.value="",e.removeAttribute("value")),t.hasAttributeNS(null,"value")?e.type==="range"&&(e.value=n):e.removeAttribute("value"))}function re(t,e){var n=t.value;if(n!==e.value&&(e.value=n),e.firstChild&&e.firstChild.nodeValue!==n){if(n===""&&e.firstChild.nodeValue===e.placeholder)return;e.firstChild.nodeValue=n}}function v(t,e,n){t[n]!==e[n]&&(e[n]=t[n],t[n]?e.setAttribute(n,""):e.removeAttribute(n))}});var M=m((Ae,I)=>{var b=A(),oe=V(),ae=3;I.exports=ce;function ce(t,e,n){return b.equal(typeof t,"object","nanomorph: oldTree should be an object"),b.equal(typeof e,"object","nanomorph: newTree should be an object"),n&&n.childrenOnly?(D(e,t),t):(b.notEqual(e.nodeType,11,"nanomorph: newTree should have one root node (which is not a DocumentFragment)"),d(e,t))}function d(t,e){return e?t?t.isSameNode&&t.isSameNode(e)?e:t.tagName!==e.tagName||L(t)!==L(e)?t:(oe(t,e),D(t,e),e):null:t}function L(t){return t.dataset?t.dataset.nanomorphComponentId:void 0}function D(t,e){for(var n,r,o,a,u=0,c=0;n=e.childNodes[c],r=t.childNodes[c-u],!(!n&&!r);c++)if(!r)e.removeChild(n),c--;else if(!n)e.appendChild(r),u++;else if(q(r,n))o=d(r,n),o!==n&&(e.replaceChild(o,n),u++);else{a=null;for(var s=c;s<e.childNodes.length;s++)if(q(e.childNodes[s],r)){a=e.childNodes[s];break}a?(o=d(r,a),o!==a&&u++,e.insertBefore(o,n)):!r.id&&!n.id?(o=d(r,n),o!==n&&(e.replaceChild(o,n),u++)):(e.insertBefore(r,n),u++)}}function q(t,e){return t.id?t.id===e.id:t.isSameNode?t.isSameNode(e):t.tagName!==e.tagName?!1:t.type===ae?t.nodeValue===e.nodeValue:!1}});var P=X(M());window.magic={templates:{},socketrefs:{},didRenderRoot:!1,socket:null,baseProps:["metaKey","ctrlKey","shiftKey"]};function _(){x();let t=new URLSearchParams(location.search);t.append("ws","0"),window.magic.socket=new WebSocket("ws://"+location.host+location.pathname+"?"+t),window.magic.socket.onopen=function(){window.magic.templates={},window.magic.socketrefs={},window.magic.didRenderRoot=!1},window.magic.socket.onmessage=function(e){we(),se(JSON.parse(e.data))},window.magic.socket.onclose=function(e){x(),console.log("Socket is closed. Reconnect will be attempted in 1 second.",e.reason),setTimeout(function(){_()},1e3)},window.magic.socket.onerror=function(e){console.error("Socket encountered error: ",e,"Closing socket"),magic.socket.close()}}function se(t){let e=new Set;t.forEach(n=>{if(n.length===2&&typeof n[0]=="number")window.magic.templates[n[0]]=n[1],pe(n[0]);else if(n.length===2&&ue(n[0])){let r=n[0];if(window.magic.socketrefs[r]===void 0&&(window.magic.socketrefs[r]=n[1]),Object.assign(window.magic.socketrefs[r],n[1]),!window.magic.didRenderRoot)return;e.add(r)}}),e.forEach(n=>{ge(n)}),window.magic.didRenderRoot||(k(document,w(H())),p(document),window.magic.didRenderRoot=!0)}function ue(t){return typeof t=="string"}function fe(t){return t&&t.length===2&&typeof t[0]=="string"}function H(){let t=magic.socketrefs[0]["#"];return y(t)}function y(t){return le(`${t[0]}:${t[1]}`,window.magic.templates[t[1]],window.magic.socketrefs[t[0]])}function le(t,e,n){return de(e,o=>{if(o==="magic:live")return me();if(o==="magic:id")return`magic-id="${t}"`;let a=n[o];return a==null?"":fe(a)?y(a):a})}function me(){return"<script>"+document.head.children[0].innerHTML+"<\/script>"}function de(t,e){return t.replace(/~.+?~/g,(n,r,o,a)=>e(n.slice(1,-1)))}function w(t){if(t.toLowerCase().trim().indexOf("<!doctype")===0){let e=document.implementation.createHTMLDocument("");return e.documentElement.innerHTML=t,e}else if("content"in document.createElement("template")){let e=document.createElement("template");return e.innerHTML=t,e.content}else{let e=document.createDocumentFragment(),n=document.createElement("body");for(n.innerHTML=t,i=0;0<n.childNodes.length;)e.appendChild(n.childNodes[i]);return e}}function k(t,e){(0,P.default)(t,e)}function pe(t){window.magic.templates[t]=window.magic.templates[t].replace(/<\w*(\s|>|\/>)/m,(e,n,r,o)=>e.endsWith("/>")?e.slice(0,-1)+" ~magic:id~/>":e.endsWith(">")?e.slice(0,-1)+" ~magic:id~>":e+"~magic:id~ ")}function ge(t){if(t===magic.socketrefs[0]["#"][0]){k(document,w(H())),p(document),console.debug("[RENDERED]",document);return}document.querySelectorAll(`[magic-id^="${t}"]`).forEach(e=>{let n=w(y(e.attributes.getNamedItem("magic-id").value.split(":")));k(e,n.children[0]),p(e),console.debug("[RENDERED]",e)})}function p(t){ve(t);let e=t.attributes;if(e)for(let n=0;n<e.length;n++)e[n].name.startsWith("magic")&&he(t,e[n]);if(t.children)for(let n=0;n<t.children.length;n++)p(t.children[n])}function he(t,e){let n=e.name.slice(6),r=e.value,o=window.magic.baseProps;switch(n){case"click":t.onclick=l(n,[...o],r);return;case"focus":t.onfocus=l(n,[...o],r);return;case"change":t.onchange=l(n,[...o],r);return;case"keydown":t.onkeydown=l(n,[...o],r);return;case"keypress":t.onkeypress=l(n,[...o],r);return;case"keyup":t.onkeyup=l(n,[...o],r);return;case"submit":t.onsubmit=l(n,[...o],r);return;case"dblclick":t.ondblclick=l(n,[...o],r);return}}function ve(t){t.onclick=null,t.onfocus=null,t.onchange=null,t.onkeydown=null,t.onkeypress=null,t.onkeyup=null,t.onsubmit=null,t.ondblclick=null}function l(t,e,n){return r=>{let o=Object.assign(be(r,e),{value:n});window.magic.socket&&window.magic.socket.send(JSON.stringify({kind:t,payload:o}))}}function be(t,e,n){let r={};for(let o=0;o<e.length;o++){let a=t[e[o]];a!==void 0&&(r[e[o]]=a)}return r}function x(){if(window.magic.topbar)return;let t=document.querySelector('meta[name="theme-color"]'),e=t?t.attributes.getNamedItem("content").value:"rgb(59,130,246)",n=document.createElement("div");n.style="position:fixed;overflow:hidden;top:0;left:0;width:100%";let r=document.createElement("div");r.style=`background-color:${e};height:.2rem;width:100%;opacity:0.4`;let o=document.createElement("div");o.style=`background-color:${e};position:absolute;bottom:0;top:0;width:50%`,o.animate([{left:"-50%"},{left:"100%"}],{duration:800,iterations:1/0}),n.appendChild(r),n.appendChild(o),document.body.appendChild(n),window.magic.topbar=n}function we(){window.magic.topbar&&(window.magic.topbar.remove(),window.magic.topbar=null)}document.addEventListener("DOMContentLoaded",_);})();
