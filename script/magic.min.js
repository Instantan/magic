(()=>{var _=Object.create;var w=Object.defineProperty;var H=Object.getOwnPropertyDescriptor;var U=Object.getOwnPropertyNames;var $=Object.getPrototypeOf,P=Object.prototype.hasOwnProperty;var l=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var W=(t,e,n,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of U(e))!P.call(t,a)&&a!==n&&w(t,a,{get:()=>e[a],enumerable:!(r=H(e,a))||r.enumerable});return t};var X=(t,e,n)=>(n=t!=null?_($(t)):{},W(e||!t||!t.__esModule?w(n,"default",{value:t,enumerable:!0}):n,t));var A=l((ge,E)=>{f.notEqual=F;f.notOk=z;f.equal=B;f.ok=f;E.exports=f;function B(t,e,n){f(t==e,n)}function F(t,e,n){f(t!=e,n)}function z(t,e){f(!t,e)}function f(t,e){if(!t)throw new Error(e||"AssertionError")}});var S=l((he,R)=>{R.exports=["onclick","ondblclick","onmousedown","onmouseup","onmouseover","onmousemove","onmouseout","onmouseenter","onmouseleave","ontouchcancel","ontouchend","ontouchmove","ontouchstart","ondragstart","ondrag","ondragenter","ondragleave","ondragover","ondrop","ondragend","onkeydown","onkeypress","onkeyup","onunload","onabort","onerror","onresize","onscroll","onselect","onchange","onsubmit","onreset","onfocus","onblur","oninput","onanimationend","onanimationiteration","onanimationstart","oncontextmenu","onfocusin","onfocusout"]});var C=l((ve,y)=>{var T=S(),J=T.length,j=1,G=3,K=8;y.exports=Q;function Q(t,e){var n=t.nodeType,r=t.nodeName;n===j&&Y(t,e),(n===G||n===K)&&e.nodeValue!==t.nodeValue&&(e.nodeValue=t.nodeValue),r==="INPUT"?ee(t,e):r==="OPTION"?N(t,e):r==="TEXTAREA"&&te(t,e),Z(t,e)}function Y(t,e){for(var n=e.attributes,r=t.attributes,a=null,u=null,c=null,s=null,o=null,p=r.length-1;p>=0;--p)o=r[p],s=o.name,a=o.namespaceURI,u=o.value,a?(s=o.localName||s,c=e.getAttributeNS(a,s),c!==u&&e.setAttributeNS(a,s,u)):e.hasAttribute(s)?(c=e.getAttribute(s),c!==u&&(u==="null"||u==="undefined"?e.removeAttribute(s):e.setAttribute(s,u))):e.setAttribute(s,u);for(var g=n.length-1;g>=0;--g)o=n[g],o.specified!==!1&&(s=o.name,a=o.namespaceURI,a?(s=o.localName||s,t.hasAttributeNS(a,s)||e.removeAttributeNS(a,s)):t.hasAttributeNS(null,s)||e.removeAttribute(s))}function Z(t,e){for(var n=0;n<J;n++){var r=T[n];t[r]?e[r]=t[r]:e[r]&&(e[r]=void 0)}}function N(t,e){h(t,e,"selected")}function ee(t,e){var n=t.value,r=e.value;h(t,e,"checked"),h(t,e,"disabled"),t.indeterminate!==e.indeterminate&&(e.indeterminate=t.indeterminate),e.type!=="file"&&(n!==r&&(e.setAttribute("value",n),e.value=n),n==="null"&&(e.value="",e.removeAttribute("value")),t.hasAttributeNS(null,"value")?e.type==="range"&&(e.value=n):e.removeAttribute("value"))}function te(t,e){var n=t.value;if(n!==e.value&&(e.value=n),e.firstChild&&e.firstChild.nodeValue!==n){if(n===""&&e.firstChild.nodeValue===e.placeholder)return;e.firstChild.nodeValue=n}}function h(t,e,n){t[n]!==e[n]&&(e[n]=t[n],t[n]?e.setAttribute(n,""):e.removeAttribute(n))}});var L=l((be,I)=>{var v=A(),ne=C(),re=3;I.exports=ie;function ie(t,e,n){return v.equal(typeof t,"object","nanomorph: oldTree should be an object"),v.equal(typeof e,"object","nanomorph: newTree should be an object"),n&&n.childrenOnly?(q(e,t),t):(v.notEqual(e.nodeType,11,"nanomorph: newTree should have one root node (which is not a DocumentFragment)"),m(e,t))}function m(t,e){return e?t?t.isSameNode&&t.isSameNode(e)?e:t.tagName!==e.tagName||O(t)!==O(e)?t:(ne(t,e),q(t,e),e):null:t}function O(t){return t.dataset?t.dataset.nanomorphComponentId:void 0}function q(t,e){for(var n,r,a,u,c=0,s=0;n=e.childNodes[s],r=t.childNodes[s-c],!(!n&&!r);s++)if(!r)e.removeChild(n),s--;else if(!n)e.appendChild(r),c++;else if(V(r,n))a=m(r,n),a!==n&&(e.replaceChild(a,n),c++);else{u=null;for(var o=s;o<e.childNodes.length;o++)if(V(e.childNodes[o],r)){u=e.childNodes[o];break}u?(a=m(r,u),a!==u&&c++,e.insertBefore(a,n)):!r.id&&!n.id?(a=m(r,n),a!==n&&(e.replaceChild(a,n),c++)):(e.insertBefore(r,n),c++)}}function V(t,e){return t.id?t.id===e.id:t.isSameNode?t.isSameNode(e):t.tagName!==e.tagName?!1:t.type===re?t.nodeValue===e.nodeValue:!1}});var M=X(L());window.magic={templates:{},socketrefs:{},didRenderRoot:!1,socket:null};function x(){let t=new URLSearchParams(location.search);t.append("ws","0"),window.magic.socket=new WebSocket("ws://"+location.host+location.pathname+"?"+t),window.magic.socket.onopen=function(){window.magic.didRenderRoot=!1},window.magic.socket.onmessage=function(e){ae(JSON.parse(e.data))},window.magic.socket.onclose=function(e){console.log("Socket is closed. Reconnect will be attempted in 1 second.",e.reason),setTimeout(function(){x()},1e3)},window.magic.socket.onerror=function(e){console.error("Socket encountered error: ",e,"Closing socket"),magic.socket.close()}}x();function ae(t){let e=new Set;t.forEach(n=>{if(n.length===2&&typeof n[0]=="number")window.magic.templates[n[0]]=n[1],le(n[0]);else if(n.length===2&&se(n[0])){let r=n[0];if(window.magic.socketrefs[r]===void 0&&(window.magic.socketrefs[r]=n[1]),Object.assign(window.magic.socketrefs[r],n[1]),!window.magic.didRenderRoot)return;e.add(r)}}),e.forEach(n=>{me(n)}),window.magic.didRenderRoot||(d(document,b(D())),window.magic.didRenderRoot=!0)}function se(t){return typeof t=="string"}function ue(t){return t.length===2&&typeof t[0]=="string"}function D(){let t=magic.socketrefs[0]["#"];return k(t)}function k(t){return oe(`${t[0]}:${t[1]}`,window.magic.templates[t[1]],window.magic.socketrefs[t[0]])}function oe(t,e,n){return fe(e,a=>{if(a==="magic:live")return ce();if(a==="magic:id")return`magic-id="${t}"`;let u=n[a];return ue(u)?k(u):u})}function ce(){return"<script>"+document.head.children[0].innerHTML+"<\/script>"}function fe(t,e){return t.replace(/~.+?~/g,(n,r,a,u)=>e(n.slice(1,-1)))}function b(t){if(t.toLowerCase().trim().indexOf("<!doctype")===0){var e=document.implementation.createHTMLDocument("");return e.documentElement.innerHTML=t,e}else if("content"in document.createElement("template")){var n=document.createElement("template");return n.innerHTML=t,n.content}else{var r=document.createDocumentFragment(),n=document.createElement("body");for(n.innerHTML=t,i=0;0<n.childNodes.length;)r.appendChild(n.childNodes[i]);return r}}function d(t,e){(0,M.default)(t,e)}function le(t){window.magic.templates[t]=window.magic.templates[t].replace(/<\w*(\s|>|\/>)/m,(e,n,r,a)=>e.endsWith("/>")?e.slice(0,-1)+" ~magic:id~/>":e.endsWith(">")?e.slice(0,-1)+" ~magic:id~>":e+"~magic:id~ ")}function me(t){if(t===magic.socketrefs[0]["#"][0]){d(document,b(D()));return}document.querySelectorAll(`[magic-id^="${t}"]`).forEach(n=>{let r=b(k(n.attributes.getNamedItem("magic-id").value.split(":")));d(n,r.children[0])})}})();
