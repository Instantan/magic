(()=>{var K=Object.create;var I=Object.defineProperty;var J=Object.getOwnPropertyDescriptor;var z=Object.getOwnPropertyNames;var G=Object.getPrototypeOf,Q=Object.prototype.hasOwnProperty;var d=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var Y=(e,t,n,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of z(t))!Q.call(e,a)&&a!==n&&I(e,a,{get:()=>t[a],enumerable:!(r=J(t,a))||r.enumerable});return e};var Z=(e,t,n)=>(n=e!=null?K(G(e)):{},Y(t||!e||!e.__esModule?I(n,"default",{value:e,enumerable:!0}):n,e));var O=d((we,V)=>{f.notEqual=N;f.notOk=ee;f.equal=j;f.ok=f;V.exports=f;function j(e,t,n){f(e==t,n)}function N(e,t,n){f(e!=t,n)}function ee(e,t){f(!e,t)}function f(e,t){if(!e)throw new Error(t||"AssertionError")}});var w=d((Pe,L)=>{L.exports=["onclick","ondblclick","onmousedown","onmouseup","onmouseover","onmousemove","onmouseout","onmouseenter","onmouseleave","ontouchcancel","ontouchend","ontouchmove","ontouchstart","ondragstart","ondrag","ondragenter","ondragleave","ondragover","ondrop","ondragend","onkeydown","onkeypress","onkeyup","onunload","onabort","onerror","onresize","onscroll","onselect","onchange","onsubmit","onreset","onfocus","onblur","oninput","onanimationend","onanimationiteration","onanimationstart","oncontextmenu","onfocusin","onfocusout"]});var M=d((qe,q)=>{var P=w(),te=P.length,ne=1,re=3,ie=8;q.exports=ae;function ae(e,t){var n=e.nodeType,r=e.nodeName;n===ne&&ce(e,t),(n===re||n===ie)&&t.nodeValue!==e.nodeValue&&(t.nodeValue=e.nodeValue),r==="INPUT"?ue(e,t):r==="OPTION"?se(e,t):r==="TEXTAREA"&&le(e,t),oe(e,t)}function ce(e,t){for(var n=t.attributes,r=e.attributes,a=null,o=null,u=null,s=null,l=null,y=r.length-1;y>=0;--y)l=r[y],s=l.name,a=l.namespaceURI,o=l.value,a?(s=l.localName||s,u=t.getAttributeNS(a,s),u!==o&&t.setAttributeNS(a,s,o)):t.hasAttribute(s)?(u=t.getAttribute(s),u!==o&&(o==="null"||o==="undefined"?t.removeAttribute(s):t.setAttribute(s,o))):t.setAttribute(s,o);for(var E=n.length-1;E>=0;--E)l=n[E],l.specified!==!1&&(s=l.name,a=l.namespaceURI,a?(s=l.localName||s,e.hasAttributeNS(a,s)||t.removeAttributeNS(a,s)):e.hasAttributeNS(null,s)||t.removeAttribute(s))}function oe(e,t){for(var n=0;n<te;n++){var r=P[n];e[r]?t[r]=e[r]:t[r]&&(t[r]=void 0)}}function se(e,t){A(e,t,"selected")}function ue(e,t){var n=e.value,r=t.value;A(e,t,"checked"),A(e,t,"disabled"),e.indeterminate!==t.indeterminate&&(t.indeterminate=e.indeterminate),t.type!=="file"&&(n!==r&&(t.setAttribute("value",n),t.value=n),n==="null"&&(t.value="",t.removeAttribute("value")),e.hasAttributeNS(null,"value")?t.type==="range"&&(t.value=n):t.removeAttribute("value"))}function le(e,t){var n=e.value;if(n!==t.value&&(t.value=n),t.firstChild&&t.firstChild.nodeValue!==n){if(n===""&&t.firstChild.nodeValue===t.placeholder)return;t.firstChild.nodeValue=n}}function A(e,t,n){e[n]!==t[n]&&(t[n]=e[n],e[n]?t.setAttribute(n,""):t.removeAttribute(n))}});var U=d((Me,H)=>{var S=O(),fe=M(),me=3;H.exports=he;function he(e,t,n){return S.equal(typeof e,"object","nanomorph: oldTree should be an object"),S.equal(typeof t,"object","nanomorph: newTree should be an object"),n&&n.childrenOnly?($(t,e),e):(S.notEqual(t.nodeType,11,"nanomorph: newTree should have one root node (which is not a DocumentFragment)"),p(t,e))}function p(e,t){return t?e?e.isSameNode&&e.isSameNode(t)?t:e.tagName!==t.tagName||x(e)!==x(t)?e:(fe(e,t),$(e,t),t):null:e}function x(e){return e.dataset?e.dataset.nanomorphComponentId:void 0}function $(e,t){for(var n,r,a,o,u=0,s=0;n=t.childNodes[s],r=e.childNodes[s-u],!(!n&&!r);s++)if(!r)t.removeChild(n),s--;else if(!n)t.appendChild(r),u++;else if(D(r,n))a=p(r,n),a!==n&&(t.replaceChild(a,n),u++);else{o=null;for(var l=s;l<t.childNodes.length;l++)if(D(t.childNodes[l],r)){o=t.childNodes[l];break}o?(a=p(r,o),a!==o&&u++,t.insertBefore(a,n)):!r.id&&!n.id?(a=p(r,n),a!==n&&(t.replaceChild(a,n),u++)):(t.insertBefore(r,n),u++)}}function D(e,t){return e.id?e.id===t.id:e.isSameNode?e.isSameNode(t):e.tagName!==t.tagName?!1:e.type===me?e.nodeValue===t.nodeValue:!1}});var v=Z(U());window.magic={templates:{},refs:{},didRenderRoot:!1,socket:null,baseProps:["metaKey","ctrlKey","shiftKey"],keyboardProps:["key","content"],themeColor:()=>{let e=document.querySelector('meta[name="theme-color"]');return e?e.attributes.getNamedItem("content").value:"rgb(59,130,246)"}};var c=window.magic;function R(e=""){F(),h("connecting");let t=c.socket;if(typeof e!="string"||e===""){let n=new URL(location.host+location.pathname);n.searchParams=new URLSearchParams(location.search),e=n.toString()}c.socket=new WebSocket((window.location.protocol==="https:"?"wss://":"ws://")+e),c.socket.onopen=()=>{t&&t.close(),c.templates={},c.refs={},c.didRenderRoot=!1},c.socket.onmessage=n=>{Te(),h("connected"),de(JSON.parse(n.data))},c.socket.onclose=n=>{c.socket&&n.srcElement.url!==c.socket.url||(F(),h("disconnected"),setTimeout(R,1e3))},c.socket.onerror=n=>{console.error("Error: ",n,"Closing socket"),c.socket.close()}}function de(e){let t=new Set;e.forEach(n=>{if(n.length===2&&typeof n[0]=="number")c.templates[n[0]]=n[1],ye(n[0]);else if(n.length===2&&typeof n[0]=="string"){let r=n[0];if(Re(r,n[1]),!c.didRenderRoot)return;t.add(r)}else Oe(n)}),t.forEach(Ee),c.didRenderRoot||((0,v.default)(document,h("connected",T(X()))),k(document),c.didRenderRoot=!0),ve()}function g(e){return e&&e.length===2&&!isNaN(e[1])}function pe(e){return e&&Array.isArray(e)&&e.length>0&&g(e[0])}function X(){return b(c.refs[0]["#"])}function ve(){let e=c.refs,t=new Set(Object.keys(e));C(t,e,"0"),t.forEach(n=>delete e[n])}function C(e,t,n){e.delete(n);let r=t[n];if(r)for(let a in r){let o=r[a];if(Array.isArray(o)){if(g(o))C(e,t,o[0]);else if(g(o[0]))for(let u=0;u<o.length;u++)C(e,t,o[u][0])}}}function b(e){return ge(`${e[0]}:${e[1]}`,c.templates[e[1]],c.refs[e[0]])}function ge(e,t,n){return ke(t,r=>{switch(r){case"magic:live":return be();case"magic-id":return r+`="${e}"`}if(n===void 0)return"";let a=n[r];if(a==null)return"";if(g(a))return b(a);if(pe(a)){let o="";for(let u=0;u<a.length;u++)o+=b(a[u]);return o}return a})}function be(){return"<script>"+document.head.children[0].innerHTML+"<\/script>"}function ke(e,t){return e.replace(/~.+?~/g,n=>t(n.slice(1,-1)))}function T(e){if(e.toLowerCase().trim().indexOf("<!doctype")===0){let r=document.implementation.createHTMLDocument("");return r.documentElement.innerHTML=e,r}else if("content"in document.createElement("template")){let r=document.createElement("template");return r.innerHTML=e,r.content}let t=document.createDocumentFragment(),n=document.createElement("body");for(n.innerHTML=e,i=0;0<n.childNodes.length;)t.appendChild(n.childNodes[i]);return t}function ye(e){c.templates[e]=c.templates[e].replace(/<\w*(\s|>|\/>)/m,t=>{let n=" ~magic-id~ ";return t.endsWith("/>")?t.slice(0,-1)+n+"/>":t.endsWith(">")?t.slice(0,-1)+n+">":t+n})}function Ee(e){if(e===magic.refs[0]["#"][0]){(0,v.default)(document,k(h("connected",T(X()))));return}document.querySelectorAll(`[magic-id^="${e}"]`).forEach(t=>{(0,v.default)(t,k(T(b(t.attributes.getNamedItem("magic-id").value.split(":"))).children[0]))})}function k(e){Se(e);let t=e.attributes;switch(e.nodeName){case"TEXTAREA":case"INPUT":e.isSameNode=Ie}if(t)for(let n=0;n<t.length;n++)t[n].name.startsWith("magic:")&&Ae(e,t[n]);if(e.children)for(let n=0;n<e.children.length;n++)k(e.children[n]);return e}function Ae(e,t){let n=t.name.slice(6),r=t.value,a=c.baseProps,o=c.keyboardProps;switch(n){case"click":e.onclick=m(n,[...a],r);return;case"focus":e.onfocus=m(n,[...a],r);return;case"change":e.onchange=m(n,[...a,...o],r);return;case"keydown":e.onkeydown=m(n,[...a,...o],r);return;case"keypress":e.onkeypress=m(n,[...a,...o],r);return;case"keyup":e.onkeyup=m(n,[...a,...o],r);return;case"submit":e.onsubmit=m(n,[...a],r);return;case"dblclick":e.ondblclick=m(n,[...a],r);return;case"patch":e.onclick=Ve;return}}function Se(e){e.onclick=e.onfocus=e.onchange=e.onkeydown=e.onkeypress=e.onkeyup=e.onsubmit=e.ondblclick=null}function m(e,t,n){return r=>{c.socket&&c.socket.send(JSON.stringify({k:e,t:Number(_(r.target)),p:Object.assign(Ce(r,t),{value:n})}))}}function Ce(e,t,n){let r={},a=t.length;for(;a--;){let o=t[a]==="content"?e.value===void 0?e.target.value:e.value:e[t[a]];o!==void 0&&(r[t[a]]=o)}return r}function F(){if(c.topbar)return;let e=u=>{let s=document.createElement("div");return s.style.cssText=u,s},t=(u,s)=>u.appendChild(s),n=c.themeColor(),r=e("position:fixed;overflow:hidden;top:0;left:0;width:100%"),a=e(`background-color:${n};position:absolute;bottom:0;top:0;width:50%`);t(r,e(`background-color:${n};height:.2rem;width:100%;opacity:0.4`)),t(r,a);let o=setTimeout(()=>{t(document.body,r),a.animate([{left:"-50%"},{left:"100%"}],{duration:800,iterations:1/0})},120);r.destroy=()=>{clearInterval(o),r.remove()},c.topbar=r}function Te(){c.topbar&&(c.topbar.destroy(),c.topbar=null)}function Re(e,t){if(c.refs[e]===void 0){c.refs[e]=t;return}Object.assign(c.refs[e],t)}function _(e){if(e&&e.attributes){let t=e.attributes.getNamedItem("magic-id");if(t!==null)return t.value.split(":",1)[0]}return e&&e.parentNode?_(e.parentNode):c.refs[0]["#"][0]}function Ie(e){let t=this;return e.prevValue===void 0||e.prevValue!==t.value?e.prevValue=t.value:t.value=e.value,!1}function Ve(e){let t=e.srcElement.attributes.getNamedItem("href").value+"",n=t.startsWith("/")?location.host+t:t;return R(n),history.pushState({},"",t),e.preventDefault?e.preventDefault():e.stopPropagation&&e.stopPropagation(),!1}function h(e,t=document){if(t.children.length===0)return;let n=t.children[0],r="magic-"+e;if(!n.classList.contains(r))return["connected","connecting","disconnected"].forEach(a=>n.classList.remove("magic-"+a)),n.classList.add(r),t}function Oe(e){let t=new CustomEvent(e.k,{target:e.t,detail:e.p});document.querySelectorAll(`[magic-id^="${e.t}"]`).forEach(n=>n.dispatchEvent(t)),window.dispatchEvent(t)}function W(e,t){if(e==="")return;if(document.querySelector(`script[src="${e}"`)){t();return}let n=document.createElement("script");n.onload=t,n.src=e,document.head.appendChild(n)}function B(e){try{new Function(`${e}()`)()}catch(t){console.error(t)}}customElements.define("magic-script",class extends HTMLElement{constructor(){super()}static get observedAttributes(){return["src","mount"]}connectedCallback(){document.head&&W(this.attributes.getNamedItem("src").value,()=>B(this.attributes.getNamedItem("mount").value))}attributeChangedCallback(e,t,n){document.head&&W(this.attributes.getNamedItem("src").value,()=>B(this.attributes.getNamedItem("mount").value))}});document.addEventListener("DOMContentLoaded",R);})();
