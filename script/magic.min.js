(()=>{var P=Object.create;var E=Object.defineProperty;var U=Object.getOwnPropertyDescriptor;var W=Object.getOwnPropertyNames;var $=Object.getPrototypeOf,F=Object.prototype.hasOwnProperty;var m=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports);var K=(n,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of W(e))!F.call(n,a)&&a!==t&&E(n,a,{get:()=>e[a],enumerable:!(r=U(e,a))||r.enumerable});return n};var X=(n,e,t)=>(t=n!=null?P($(n)):{},K(e||!n||!n.__esModule?E(t,"default",{value:n,enumerable:!0}):t,n));var A=m((be,R)=>{f.notEqual=J;f.notOk=j;f.equal=B;f.ok=f;R.exports=f;function B(n,e,t){f(n==e,t)}function J(n,e,t){f(n!=e,t)}function j(n,e){f(!n,e)}function f(n,e){if(!n)throw new Error(e||"AssertionError")}});var S=m((we,T)=>{T.exports=["onclick","ondblclick","onmousedown","onmouseup","onmouseover","onmousemove","onmouseout","onmouseenter","onmouseleave","ontouchcancel","ontouchend","ontouchmove","ontouchstart","ondragstart","ondrag","ondragenter","ondragleave","ondragover","ondrop","ondragend","onkeydown","onkeypress","onkeyup","onunload","onabort","onerror","onresize","onscroll","onselect","onchange","onsubmit","onreset","onfocus","onblur","oninput","onanimationend","onanimationiteration","onanimationstart","oncontextmenu","onfocusin","onfocusout"]});var V=m((ye,O)=>{var C=S(),z=C.length,G=1,Q=3,Y=8;O.exports=Z;function Z(n,e){var t=n.nodeType,r=n.nodeName;t===G&&N(n,e),(t===Q||t===Y)&&e.nodeValue!==n.nodeValue&&(e.nodeValue=n.nodeValue),r==="INPUT"?te(n,e):r==="OPTION"?ne(n,e):r==="TEXTAREA"&&ie(n,e),ee(n,e)}function N(n,e){for(var t=e.attributes,r=n.attributes,a=null,c=null,u=null,o=null,s=null,h=r.length-1;h>=0;--h)s=r[h],o=s.name,a=s.namespaceURI,c=s.value,a?(o=s.localName||o,u=e.getAttributeNS(a,o),u!==c&&e.setAttributeNS(a,o,c)):e.hasAttribute(o)?(u=e.getAttribute(o),u!==c&&(c==="null"||c==="undefined"?e.removeAttribute(o):e.setAttribute(o,c))):e.setAttribute(o,c);for(var d=t.length-1;d>=0;--d)s=t[d],s.specified!==!1&&(o=s.name,a=s.namespaceURI,a?(o=s.localName||o,n.hasAttributeNS(a,o)||e.removeAttributeNS(a,o)):n.hasAttributeNS(null,o)||e.removeAttribute(o))}function ee(n,e){for(var t=0;t<z;t++){var r=C[t];n[r]?e[r]=n[r]:e[r]&&(e[r]=void 0)}}function ne(n,e){v(n,e,"selected")}function te(n,e){var t=n.value,r=e.value;v(n,e,"checked"),v(n,e,"disabled"),n.indeterminate!==e.indeterminate&&(e.indeterminate=n.indeterminate),e.type!=="file"&&(t!==r&&(e.setAttribute("value",t),e.value=t),t==="null"&&(e.value="",e.removeAttribute("value")),n.hasAttributeNS(null,"value")?e.type==="range"&&(e.value=t):e.removeAttribute("value"))}function ie(n,e){var t=n.value;if(t!==e.value&&(e.value=t),e.firstChild&&e.firstChild.nodeValue!==t){if(t===""&&e.firstChild.nodeValue===e.placeholder)return;e.firstChild.nodeValue=t}}function v(n,e,t){n[t]!==e[t]&&(e[t]=n[t],n[t]?e.setAttribute(t,""):e.removeAttribute(t))}});var I=m((Ee,M)=>{var k=A(),re=V(),ae=3;M.exports=ce;function ce(n,e,t){return k.equal(typeof n,"object","nanomorph: oldTree should be an object"),k.equal(typeof e,"object","nanomorph: newTree should be an object"),t&&t.childrenOnly?(L(e,n),n):(k.notEqual(e.nodeType,11,"nanomorph: newTree should have one root node (which is not a DocumentFragment)"),g(e,n))}function g(n,e){return e?n?n.isSameNode&&n.isSameNode(e)?e:n.tagName!==e.tagName||q(n)!==q(e)?n:(re(n,e),L(n,e),e):null:n}function q(n){return n.dataset?n.dataset.nanomorphComponentId:void 0}function L(n,e){for(var t,r,a,c,u=0,o=0;t=e.childNodes[o],r=n.childNodes[o-u],!(!t&&!r);o++)if(!r)e.removeChild(t),o--;else if(!t)e.appendChild(r),u++;else if(D(r,t))a=g(r,t),a!==t&&(e.replaceChild(a,t),u++);else{c=null;for(var s=o;s<e.childNodes.length;s++)if(D(e.childNodes[s],r)){c=e.childNodes[s];break}c?(a=g(r,c),a!==c&&u++,e.insertBefore(a,t)):!r.id&&!t.id?(a=g(r,t),a!==t&&(e.replaceChild(a,t),u++)):(e.insertBefore(r,t),u++)}}function D(n,e){return n.id?n.id===e.id:n.isSameNode?n.isSameNode(e):n.tagName!==e.tagName?!1:n.type===ae?n.nodeValue===e.nodeValue:!1}});var x=X(I());window.magic={templates:{},socketrefs:{},didRenderRoot:!1,socket:null,baseProps:["metaKey","ctrlKey","shiftKey"]};function _(){let n=new URLSearchParams(location.search);n.append("ws","0"),window.magic.socket=new WebSocket("ws://"+location.host+location.pathname+"?"+n),window.magic.socket.onopen=function(){window.magic.templates={},window.magic.socketrefs={},window.magic.didRenderRoot=!1},window.magic.socket.onmessage=function(e){oe(JSON.parse(e.data))},window.magic.socket.onclose=function(e){console.log("Socket is closed. Reconnect will be attempted in 1 second.",e.reason),setTimeout(function(){_()},1e3)},window.magic.socket.onerror=function(e){console.error("Socket encountered error: ",e,"Closing socket"),magic.socket.close()}}_();function oe(n){let e=new Set;n.forEach(t=>{if(t.length===2&&typeof t[0]=="number")window.magic.templates[t[0]]=t[1],ge(t[0]);else if(t.length===2&&se(t[0])){let r=t[0];if(window.magic.socketrefs[r]===void 0&&(window.magic.socketrefs[r]=t[1]),Object.assign(window.magic.socketrefs[r],t[1]),!window.magic.didRenderRoot)return;e.add(r)}}),e.forEach(t=>{pe(t)}),window.magic.didRenderRoot||(w(document,b(H())),p(document),window.magic.didRenderRoot=!0)}function se(n){return typeof n=="string"}function ue(n){return n&&n.length===2&&typeof n[0]=="string"}function H(){let n=magic.socketrefs[0]["#"];return y(n)}function y(n){return fe(`${n[0]}:${n[1]}`,window.magic.templates[n[1]],window.magic.socketrefs[n[0]])}function fe(n,e,t){return me(e,a=>{if(a==="magic:live")return le();if(a==="magic:id")return`magic-id="${n}"`;let c=t[a];return c==null?"":ue(c)?y(c):c})}function le(){return"<script>"+document.head.children[0].innerHTML+"<\/script>"}function me(n,e){return n.replace(/~.+?~/g,(t,r,a,c)=>e(t.slice(1,-1)))}function b(n){if(n.toLowerCase().trim().indexOf("<!doctype")===0){let e=document.implementation.createHTMLDocument("");return e.documentElement.innerHTML=n,e}else if("content"in document.createElement("template")){let e=document.createElement("template");return e.innerHTML=n,e.content}else{let e=document.createDocumentFragment(),t=document.createElement("body");for(t.innerHTML=n,i=0;0<t.childNodes.length;)e.appendChild(t.childNodes[i]);return e}}function w(n,e){(0,x.default)(n,e)}function ge(n){window.magic.templates[n]=window.magic.templates[n].replace(/<\w*(\s|>|\/>)/m,(e,t,r,a)=>e.endsWith("/>")?e.slice(0,-1)+" ~magic:id~/>":e.endsWith(">")?e.slice(0,-1)+" ~magic:id~>":e+"~magic:id~ ")}function pe(n){if(n===magic.socketrefs[0]["#"][0]){w(document,b(H())),p(document),console.debug("[RENDERED]",document);return}document.querySelectorAll(`[magic-id^="${n}"]`).forEach(e=>{let t=b(y(e.attributes.getNamedItem("magic-id").value.split(":")));w(e,t.children[0]),p(e),console.debug("[RENDERED]",e)})}function p(n){de(n);let e=n.attributes;if(e)for(let t=0;t<e.length;t++)e[t].name.startsWith("magic")&&he(n,e[t]);if(n.children)for(let t=0;t<n.children.length;t++)p(n.children[t])}function he(n,e){let t=e.name.slice(6),r=e.value,a=window.magic.baseProps;switch(t){case"click":n.onclick=l(t,[...a],r);return;case"focus":n.onfocus=l(t,[...a],r);return;case"change":n.onchange=l(t,[...a],r);return;case"keydown":n.onkeydown=l(t,[...a],r);return;case"keypress":n.onkeypress=l(t,[...a],r);return;case"keyup":n.onkeyup=l(t,[...a],r);return;case"submit":n.onsubmit=l(t,[...a],r);return;case"dblclick":n.ondblclick=l(t,[...a],r);return}}function de(n){n.onclick=null,n.onfocus=null,n.onchange=null,n.onkeydown=null,n.onkeypress=null,n.onkeyup=null,n.onsubmit=null,n.ondblclick=null}function l(n,e,t){return r=>{let a=Object.assign(ve(r,e),{value:t});window.magic.socket&&window.magic.socket.send(JSON.stringify({kind:n,payload:a}))}}function ve(n,e,t){let r={};for(let a=0;a<e.length;a++){let c=n[e[a]];c!==void 0&&(r[e[a]]=c)}return r}})();
